<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lojas Próximas - Sistema Completo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .store-card {
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .store-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .category-btn {
            transition: all 0.3s ease;
        }
        
        .category-btn:hover {
            transform: scale(1.05);
        }
        
        .category-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .search-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .floating-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        
        .floating-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .admin-panel {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .merchant-panel {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .hidden { display: none !important; }
        .show { display: block !important; }

        .news-timer {
            position: relative;
            overflow: hidden;
        }

        .news-timer::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: linear-gradient(90deg, #10B981, #3B82F6);
            animation: timer-progress linear;
        }

        @keyframes timer-progress {
            from { width: 100%; }
            to { width: 0%; }
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e5e7eb;
            border: 1px solid #e5e7eb;
        }

        .calendar-day {
            background: white;
            padding: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .calendar-day:hover {
            background: #f3f4f6;
        }

        .calendar-day.selected {
            background: #3b82f6;
            color: white;
        }

        .calendar-day.unavailable {
            background: #f9fafb;
            color: #9ca3af;
            cursor: not-allowed;
        }

        .category-tag {
            display: inline-block;
            padding: 4px 8px;
            margin: 2px;
            background: #f3f4f6;
            border-radius: 12px;
            font-size: 12px;
            color: #374151;
        }

        .logo-preview {
            max-width: 200px;
            max-height: 100px;
            object-fit: contain;
        }

        .story-container {
            position: relative;
            border-radius: 20px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .story-container:hover {
            transform: scale(1.02);
        }

        .story-progress {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            height: 3px;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
            overflow: hidden;
        }

        .story-progress-bar {
            height: 100%;
            background: white;
            border-radius: 2px;
            animation: story-timer linear;
        }

        @keyframes story-timer {
            from { width: 0%; }
            to { width: 100%; }
        }

        .story-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.7));
            color: white;
            padding: 20px;
        }

        .story-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: black;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .story-content {
            max-width: 400px;
            max-height: 80vh;
            position: relative;
            border-radius: 20px;
            overflow: hidden;
        }

        .story-content img, .story-content video {
            width: 100%;
            height: auto;
            max-height: 80vh;
            object-fit: cover;
        }

        .story-controls {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-size: 2rem;
            background: rgba(0,0,0,0.5);
            border: none;
            padding: 10px 15px;
            border-radius: 50%;
            cursor: pointer;
            transition: background 0.3s;
        }

        .story-controls:hover {
            background: rgba(0,0,0,0.8);
        }

        .story-prev {
            left: 20px;
        }

        .story-next {
            right: 20px;
        }

        .story-close {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 2rem;
            background: rgba(0,0,0,0.5);
            border: none;
            padding: 10px 15px;
            border-radius: 50%;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <div></div>
                <button onclick="hideAllModals()" class="text-gray-500 hover:text-gray-700 text-2xl">×</button>
            </div>
            <div class="text-center mb-6">
                <div id="loginLogo" class="w-20 h-20 mx-auto mb-4 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center text-white text-2xl font-bold">
                    LOGO
                </div>
                <h2 class="text-2xl font-bold text-gray-800">Fazer Login</h2>
                <p class="text-gray-600">Acesse sua conta</p>
            </div>
            
            <form id="loginForm">
                <div class="space-y-4">
                    <input type="email" id="loginEmail" placeholder="Email" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                    <input type="password" id="loginPassword" placeholder="Senha" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                    <select id="loginType" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                        <option value="">Tipo de usuário</option>
                        <option value="admin">Administrador</option>
                        <option value="merchant">Comerciante</option>
                        <option value="customer">Cliente</option>
                    </select>
                </div>
                <button type="submit" class="w-full mt-6 px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 transition-all">
                    Entrar
                </button>
            </form>
            
            <div class="mt-6 text-center space-y-2">
                <button onclick="showForgotPasswordForm()" class="text-purple-600 hover:text-purple-700 block w-full">
                    Esqueceu sua senha?
                </button>
                <button onclick="showRegisterForm()" class="text-purple-600 hover:text-purple-700 block w-full">
                    Não tem conta? Cadastre-se como Comerciante
                </button>
                <button onclick="showCustomerRegisterForm()" class="text-purple-600 hover:text-purple-700">
                    Cadastrar como Cliente
                </button>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div id="forgotPasswordModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <div></div>
                <button onclick="hideAllModals()" class="text-gray-500 hover:text-gray-700 text-2xl">×</button>
            </div>
            <div class="text-center mb-6">
                <div class="w-20 h-20 mx-auto mb-4 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center text-white text-2xl font-bold">
                    🔑
                </div>
                <h2 class="text-2xl font-bold text-gray-800">Recuperar Senha</h2>
                <p class="text-gray-600">Digite seu email para receber instruções</p>
            </div>
            
            <form id="forgotPasswordForm">
                <div class="space-y-4">
                    <input type="email" id="forgotEmail" placeholder="Seu email" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                    <select id="forgotUserType" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                        <option value="">Tipo de usuário</option>
                        <option value="admin">Administrador</option>
                        <option value="merchant">Comerciante</option>
                    </select>
                </div>
                <button type="submit" class="w-full mt-6 px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 transition-all">
                    Enviar Instruções
                </button>
            </form>
            
            <div class="mt-6 text-center">
                <button onclick="showLoginModal()" class="text-purple-600 hover:text-purple-700">
                    Voltar ao login
                </button>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <div></div>
                <button onclick="hideAllModals()" class="text-gray-500 hover:text-gray-700 text-2xl">×</button>
            </div>
            <div class="text-center mb-6">
                <div class="w-20 h-20 mx-auto mb-4 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center text-white text-2xl font-bold">
                    LOGO
                </div>
                <h2 class="text-2xl font-bold text-gray-800">Cadastrar Comerciante</h2>
                <p class="text-gray-600">Crie sua conta</p>
            </div>
            
            <form id="registerForm">
                <div class="space-y-4">
                    <input type="text" id="registerName" placeholder="Nome completo" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                    <input type="email" id="registerEmail" placeholder="Email" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                    <input type="tel" id="registerPhone" placeholder="Telefone (11) 99999-9999" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                    <input type="text" id="registerDocument" placeholder="CNPJ ou CPF" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                    <input type="text" id="registerStoreName" placeholder="Nome do comércio" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                    <input type="text" id="registerAddress" placeholder="Endereço completo" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                    <input type="password" id="registerPassword" placeholder="Senha" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                    <input type="password" id="registerConfirmPassword" placeholder="Confirmar senha" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                </div>
                <button type="submit" class="w-full mt-6 px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 transition-all">
                    Cadastrar
                </button>
            </form>
            
            <div class="mt-6 text-center">
                <button onclick="showLoginModal()" class="text-purple-600 hover:text-purple-700">
                    Já tem conta? Faça login
                </button>
            </div>
        </div>
    </div>

    <!-- Customer Register Modal -->
    <div id="customerRegisterModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <div></div>
                <button onclick="hideAllModals()" class="text-gray-500 hover:text-gray-700 text-2xl">×</button>
            </div>
            <div class="text-center mb-6">
                <div class="w-20 h-20 mx-auto mb-4 bg-gradient-to-r from-green-600 to-blue-600 rounded-full flex items-center justify-center text-white text-2xl font-bold">
                    👤
                </div>
                <h2 class="text-2xl font-bold text-gray-800">Cadastrar Cliente</h2>
                <p class="text-gray-600">Crie sua conta de cliente</p>
            </div>
            
            <form id="customerRegisterForm">
                <div class="space-y-4">
                    <input type="text" id="customerRegisterName" placeholder="Nome completo" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" required>
                    <input type="email" id="customerRegisterEmail" placeholder="Email" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" required>
                    <input type="tel" id="customerRegisterPhone" placeholder="Telefone (11) 99999-9999 (opcional)" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                    <input type="password" id="customerRegisterPassword" placeholder="Senha" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" required>
                    <input type="password" id="customerRegisterConfirmPassword" placeholder="Confirmar senha" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" required>
                    <input type="text" id="customerRegisterAddress" placeholder="Endereço completo (opcional)" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                    <div class="grid grid-cols-3 gap-2">
                        <input type="text" id="customerRegisterNeighborhood" placeholder="Bairro" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                        <input type="text" id="customerRegisterZone" placeholder="Zona" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                        <input type="text" id="customerRegisterState" placeholder="Estado" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                    </div>
                </div>
                <button type="submit" class="w-full mt-6 px-6 py-3 bg-gradient-to-r from-green-600 to-blue-600 text-white rounded-lg hover:from-green-700 hover:to-blue-700 transition-all">
                    Cadastrar Cliente
                </button>
            </form>
            
            <div class="mt-6 text-center">
                <button onclick="showLoginModal()" class="text-green-600 hover:text-green-700">
                    Já tem conta? Faça login
                </button>
            </div>
        </div>
    </div>

    <!-- Public View -->
    <div id="publicView">
        <!-- Header -->
        <header class="search-container text-white py-8">
            <div class="container mx-auto px-4">
                <div class="flex justify-between items-center mb-6">
                    <div class="flex items-center">
                        <div id="appLogo" class="w-20 h-20 bg-white/20 rounded-full flex items-center justify-center text-2xl font-bold mr-4 shadow-lg">
                            MB
                        </div>
                        <div class="text-left">
                            <h1 id="appTitle" class="text-3xl font-bold">Meu Bairro</h1>
                            <p id="appSlogan" class="text-lg opacity-90">Conectando você ao seu bairro</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <!-- Admin Panel Button -->
                        <div id="adminPanelButton" class="hidden">
                            <button onclick="showAdminPanel()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-full transition-colors flex items-center">
                                <span class="mr-2">👨‍💼</span>
                                <span>Painel Admin</span>
                            </button>
                        </div>
                        
                        <!-- Merchant Panel Button -->
                        <div id="merchantPanelButton" class="hidden">
                            <button onclick="showMerchantPanel()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-full transition-colors flex items-center">
                                <span class="mr-2">🏪</span>
                                <span>Painel Comerciante</span>
                            </button>
                        </div>
                        
                        <!-- Customer Menu Button -->
                        <div id="customerMenuButton" class="hidden">
                            <button onclick="showCustomerPanel()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-full transition-colors flex items-center">
                                <span class="mr-2">👤</span>
                                <span id="customerHeaderName">Cliente</span>
                            </button>
                        </div>
                        
                        <!-- Login Button -->
                        <div id="loginButton">
                            <button onclick="showLoginModal()" class="bg-white/20 hover:bg-white/30 px-6 py-2 rounded-full transition-colors">
                                Login
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Search Bar -->
                <div class="max-w-4xl mx-auto">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <div class="relative">
                                <input 
                                    type="text" 
                                    id="searchInput"
                                    placeholder="Buscar lojas, produtos ou serviços..."
                                    class="w-full px-6 py-4 rounded-full text-gray-800 text-lg focus:outline-none focus:ring-4 focus:ring-white/30"
                                >
                                <button class="absolute right-2 top-2 bg-white text-purple-600 p-2 rounded-full hover:bg-gray-100 transition-colors">
                                    🔍
                                </button>
                            </div>
                        </div>
                        <div class="grid grid-cols-3 gap-2">
                            <select id="stateFilter" class="px-4 py-4 rounded-full text-gray-800 focus:outline-none focus:ring-4 focus:ring-white/30" onchange="updateLocationFilters()">
                                <option value="">Estado</option>
                            </select>
                            <select id="zoneFilter" class="px-4 py-4 rounded-full text-gray-800 focus:outline-none focus:ring-4 focus:ring-white/30" onchange="updateLocationFilters()">
                                <option value="">Zona</option>
                            </select>
                            <select id="neighborhoodFilter" class="px-4 py-4 rounded-full text-gray-800 focus:outline-none focus:ring-4 focus:ring-white/30" onchange="filterByLocation()">
                                <option value="">Bairro</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Categories -->
        <section class="py-8 bg-white">
            <div class="container mx-auto px-4">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Categorias</h2>
                    <div class="flex items-center gap-3">
                        <span class="text-gray-600">Siga-nos:</span>
                        <a href="#" onclick="openInstagram()" class="bg-gradient-to-r from-pink-500 to-purple-600 text-white px-4 py-2 rounded-full hover:from-pink-600 hover:to-purple-700 transition-all flex items-center gap-2">
                            <span class="text-lg">📷</span>
                            <span>Instagram</span>
                        </a>
                    </div>
                </div>
                <div class="flex flex-wrap justify-center gap-4" id="categories">
                    <!-- Categories will be populated by JavaScript -->
                </div>
            </div>
        </section>

        <!-- Stores Grid -->
        <section class="py-8">
            <div class="container mx-auto px-4">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">🏪 Comerciantes do Bairro</h2>
                    <div class="flex items-center gap-2 text-gray-600">
                        📍 <span>São Paulo, SP</span>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="storesGrid">
                    <!-- Store cards will be populated by JavaScript -->
                </div>
            </div>
        </section>

        <!-- Stories Section -->
        <section class="py-8 bg-gradient-to-r from-blue-50 to-purple-50">
            <div class="container mx-auto px-4">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">📱 Stories e Novidades</h2>
                <div class="flex gap-4 overflow-x-auto pb-4" id="storiesContainer">
                    <!-- Stories will be populated by JavaScript -->
                </div>
                
                <!-- Traditional News Grid -->
                <div class="mt-8">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">📰 Notícias Recentes</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="newsGrid">
                        <!-- News will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="hidden">
        <header class="admin-panel text-white py-6">
            <div class="container mx-auto px-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center text-xl font-bold mr-3">
                            MB
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold">Painel Administrativo</h1>
                            <p class="opacity-90">Gerencie todas as lojas</p>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="showPublicView()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-colors">
                            🏠 Página Inicial
                        </button>
                        <button onclick="logout()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-colors">
                            Sair
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <div class="container mx-auto px-4 py-8">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl p-6 shadow-lg">
                    <div class="flex items-center">
                        <div class="text-3xl mr-4">🏪</div>
                        <div>
                            <p class="text-gray-600">Total de Lojas</p>
                            <p class="text-2xl font-bold" id="totalStores">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-lg">
                    <div class="flex items-center">
                        <div class="text-3xl mr-4">👥</div>
                        <div>
                            <p class="text-gray-600">Lojistas</p>
                            <p class="text-2xl font-bold" id="totalMerchants">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-lg">
                    <div class="flex items-center">
                        <div class="text-3xl mr-4">👥</div>
                        <div>
                            <p class="text-gray-600">Clientes</p>
                            <p class="text-2xl font-bold" id="totalCustomers">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-lg">
                    <div class="flex items-center">
                        <div class="text-3xl mr-4">⏳</div>
                        <div>
                            <p class="text-gray-600">Pendentes</p>
                            <p class="text-2xl font-bold" id="totalPending">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Actions -->
            <div class="bg-white rounded-xl p-6 shadow-lg mb-8">
                <h3 class="text-xl font-bold mb-4">Ações Administrativas</h3>
                <div class="flex flex-wrap gap-4">
                    <button onclick="showAllStores()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors">
                        Ver Todas as Lojas
                    </button>
                    <button onclick="showMerchants()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg transition-colors">
                        Gerenciar Lojistas
                    </button>
                    <button onclick="showCustomers()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg transition-colors">
                        Gerenciar Clientes
                    </button>
                    <button onclick="manageNews()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg transition-colors">
                        Gerenciar Notícias
                    </button>
                    <button onclick="showAppSettings()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg transition-colors">
                        Configurações do App
                    </button>
                </div>
            </div>

            <!-- Admin Content Area -->
            <div id="adminContent" class="bg-white rounded-xl p-6 shadow-lg">
                <h3 class="text-xl font-bold mb-4">Dashboard</h3>
                <p class="text-gray-600">Selecione uma ação acima para começar.</p>
            </div>
        </div>
    </div>

    <!-- Customer Panel -->
    <div id="customerPanel" class="hidden">
        <header class="bg-gradient-to-r from-green-600 to-blue-600 text-white py-6">
            <div class="container mx-auto px-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center text-xl font-bold mr-3">
                            👤
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold">Minhas Solicitações e Reservas</h1>
                            <p class="opacity-90" id="customerPanelName">Cliente</p>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="showPublicView()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-colors">
                            🏠 Página Inicial
                        </button>
                        <button onclick="logout()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-colors">
                            Sair
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <div class="container mx-auto px-4 py-8">
            <!-- Customer Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl p-6 shadow-lg">
                    <div class="flex items-center">
                        <div class="text-3xl mr-4">📅</div>
                        <div>
                            <p class="text-gray-600">Agendamentos</p>
                            <p class="text-2xl font-bold" id="customerAppointments">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-lg">
                    <div class="flex items-center">
                        <div class="text-3xl mr-4">🛒</div>
                        <div>
                            <p class="text-gray-600">Reservas</p>
                            <p class="text-2xl font-bold" id="customerReservations">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-lg">
                    <div class="flex items-center">
                        <div class="text-3xl mr-4">❤️</div>
                        <div>
                            <p class="text-gray-600">Favoritos</p>
                            <p class="text-2xl font-bold" id="customerFavorites">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-lg">
                    <div class="flex items-center">
                        <div class="text-3xl mr-4">⭐</div>
                        <div>
                            <p class="text-gray-600">Avaliações</p>
                            <p class="text-2xl font-bold" id="customerRatings">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Customer Actions -->
            <div class="bg-white rounded-xl p-6 shadow-lg mb-8">
                <h3 class="text-xl font-bold mb-4">Ações</h3>
                <div class="flex flex-wrap gap-4">
                    <button onclick="showMyAppointmentsList()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors">
                        📅 Meus Agendamentos
                    </button>
                    <button onclick="showMyReservationsList()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg transition-colors">
                        🛒 Minhas Reservas
                    </button>
                    <button onclick="showMyFavoritesList()" class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg transition-colors">
                        ❤️ Meus Favoritos
                    </button>
                    <button onclick="showMyProfile()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg transition-colors">
                        👤 Meu Perfil
                    </button>
                </div>
            </div>

            <!-- Customer Content Area -->
            <div id="customerContent" class="bg-white rounded-xl p-6 shadow-lg">
                <h3 class="text-xl font-bold mb-4">Dashboard do Cliente</h3>
                <p class="text-gray-600">Selecione uma ação acima para começar.</p>
            </div>
        </div>
    </div>

    <!-- Merchant Panel -->
    <div id="merchantPanel" class="hidden">
        <header class="merchant-panel text-white py-6">
            <div class="container mx-auto px-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center text-xl font-bold mr-3">
                            MB
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold">Painel do Comerciante</h1>
                            <p class="opacity-90" id="merchantStoreName">Meu Comércio</p>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="showPublicView()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-colors">
                            🏠 Página Inicial
                        </button>
                        <button onclick="logout()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-colors">
                            Sair
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <div class="container mx-auto px-4 py-8">
            <!-- Merchant Stats -->
            <div class="grid grid-cols-1 md:grid-cols-5 gap-6 mb-8">
                <div class="bg-white rounded-xl p-6 shadow-lg">
                    <div class="flex items-center">
                        <div class="text-3xl mr-4">👁️</div>
                        <div>
                            <p class="text-gray-600">Visualizações</p>
                            <p class="text-2xl font-bold" id="storeViews">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-lg">
                    <div class="flex items-center">
                        <div class="text-3xl mr-4">⭐</div>
                        <div>
                            <p class="text-gray-600">Curtidas</p>
                            <p class="text-2xl font-bold" id="storeLikes">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-lg">
                    <div class="flex items-center">
                        <div class="text-3xl mr-4">📊</div>
                        <div>
                            <p class="text-gray-600">Avaliação</p>
                            <p class="text-2xl font-bold" id="storeRating">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-lg">
                    <div class="flex items-center">
                        <div class="text-3xl mr-4">📞</div>
                        <div>
                            <p class="text-gray-600">Contatos</p>
                            <p class="text-2xl font-bold" id="storeContacts">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-lg">
                    <div class="flex items-center">
                        <div class="text-3xl mr-4">🛒</div>
                        <div>
                            <p class="text-gray-600">Reservas</p>
                            <p class="text-2xl font-bold" id="storeReservations">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Merchant Actions -->
            <div class="bg-white rounded-xl p-6 shadow-lg mb-8">
                <h3 class="text-xl font-bold mb-4">Ações</h3>
                <div class="flex flex-wrap gap-4">
                    <button onclick="showStoreSettings()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors">
                        🏪 Configurações da Loja
                    </button>
                    <button onclick="showProductsManagement()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg transition-colors">
                        📦 Gerenciar Produtos
                    </button>
                    <button onclick="showCalendarManagement()" class="bg-orange-600 hover:bg-orange-700 text-white px-6 py-3 rounded-lg transition-colors">
                        📅 Gerenciar Calendário
                    </button>
                    <button onclick="showReservationsManagement()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg transition-colors">
                        🛒 Gerenciar Reservas
                    </button>
                </div>
            </div>

            <!-- Merchant Content Area -->
            <div id="merchantContent" class="bg-white rounded-xl p-6 shadow-lg">
                <h3 class="text-xl font-bold mb-4">Dashboard do Comerciante</h3>
                <p class="text-gray-600">Selecione uma ação acima para começar.</p>
            </div>
        </div>
    </div>

    <!-- Customer Sidebar -->
    <div id="customerSidebar" class="fixed left-0 top-0 h-full w-80 bg-white shadow-lg transform -translate-x-full transition-transform duration-300 z-50 hidden">
        <div class="p-6 border-b bg-gradient-to-r from-green-600 to-blue-600 text-white">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center text-xl font-bold mr-3">
                        👤
                    </div>
                    <div>
                        <h2 class="text-lg font-bold" id="customerSidebarName">Cliente</h2>
                        <p class="text-sm opacity-90">Bem-vindo!</p>
                    </div>
                </div>
                <button onclick="closeSidebar()" class="text-white hover:text-gray-200">
                    ✕
                </button>
            </div>
        </div>
        
        <div class="p-4">
            <nav class="space-y-2">
                <button onclick="showCustomerProfile()" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 flex items-center">
                    <span class="mr-3">👤</span>
                    Meu Perfil
                </button>
                <button onclick="showFavoriteStores()" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 flex items-center">
                    <span class="mr-3">❤️</span>
                    Lojas Favoritas
                </button>
                <button onclick="showMyAppointments()" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 flex items-center">
                    <span class="mr-3">📅</span>
                    Meus Agendamentos
                </button>
                <hr class="my-4">
                <button onclick="logout()" class="w-full text-left px-4 py-3 rounded-lg hover:bg-red-50 text-red-600 flex items-center">
                    <span class="mr-3">🚪</span>
                    Sair
                </button>
            </nav>
        </div>
    </div>

    <!-- Sidebar Overlay -->
    <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden" onclick="closeSidebar()"></div>

    <!-- Edit Merchant Modal -->
    <div id="editMerchantModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">✏️ Editar Lojista</h2>
                <button onclick="closeEditMerchantModal()" class="text-gray-500 hover:text-gray-700 text-2xl">×</button>
            </div>
            
            <form id="editMerchantForm">
                <input type="hidden" id="editMerchantId">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Nome Completo</label>
                        <input type="text" id="editMerchantName" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Email</label>
                        <input type="email" id="editMerchantEmail" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Telefone</label>
                        <input type="tel" id="editMerchantPhone" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">CNPJ/CPF</label>
                        <input type="text" id="editMerchantDocument" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Nome da Loja</label>
                        <input type="text" id="editMerchantStoreName" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Status</label>
                        <select id="editMerchantStatus" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            <option value="pending">Pendente</option>
                            <option value="approved">Aprovado</option>
                            <option value="rejected">Rejeitado</option>
                            <option value="inactive">Inativo</option>
                        </select>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-gray-700 font-medium mb-2">Endereço Completo</label>
                        <input type="text" id="editMerchantAddress" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Nova Senha (opcional)</label>
                        <input type="password" id="editMerchantPassword" placeholder="Deixe vazio para manter a atual" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Confirmar Nova Senha</label>
                        <input type="password" id="editMerchantConfirmPassword" placeholder="Confirme a nova senha" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
                
                <div class="mt-6 flex gap-4">
                    <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors">
                        Salvar Alterações
                    </button>
                    <button type="button" onclick="closeEditMerchantModal()" class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Support Button -->
    <button onclick="showSupport()" class="floating-btn w-14 h-14 rounded-full text-white text-2xl shadow-lg">
        📞
    </button>

    <script>
        // Global variables
        let appSettings = {
            name: "Meu Bairro",
            slogan: "Conectando você ao seu bairro",
            description: "Plataforma que conecta moradores com os melhores negócios do bairro",
            logo: {
                type: "text", // text, image, video
                content: "MB"
            },
            contact: {
                phone: "(11) 99999-9999",
                whatsapp: "(11) 99999-9999",
                email: "suporte@meubairro.com",
                hours: "Segunda a Sexta, 8h às 18h"
            },
            social: {
                instagram: "@meubairro_oficial"
            }
        };

        let availableCategories = [
            { id: 'todos', name: 'Todos', emoji: '🏪', type: 'emoji' },
            { id: 'alimentacao', name: 'Alimentação', emoji: '🍕', type: 'emoji' },
            { id: 'moda', name: 'Moda', emoji: '👕', type: 'emoji' },
            { id: 'servicos', name: 'Serviços', emoji: '🔧', type: 'emoji' },
            { id: 'saude', name: 'Saúde', emoji: '💊', type: 'emoji' },
            { id: 'beleza', name: 'Beleza', emoji: '💄', type: 'emoji' }
        ];

        // Sample data
        let stores = [
            {
                id: 1,
                name: "Padaria Pão Quente",
                category: "alimentacao",
                categories: ["Pães", "Doces", "Salgados", "Bebidas", "Bolos"],
                address: "Rua das Flores, 123, Centro",
                neighborhood: "Centro",
                zone: "Centro",
                state: "SP",
                phone: "(11) 99999-9999",
                description: "Pães quentinhos saindo do forno o dia todo",
                distance: "150m",
                rating: 4.8,
                emoji: "🥖",
                status: "approved",
                merchantId: 1,
                views: 245,
                contacts: 12,
                likes: 15,
                products: [
                    {
                        id: 1,
                        name: "Pão Francês",
                        price: 0.50,
                        category: "produto",
                        emoji: "🥖",
                        description: "Pão francês fresquinho",
                        available: true,
                        stock: 100,
                        createdAt: new Date()
                    },
                    {
                        id: 2,
                        name: "Bolo de Chocolate",
                        price: 25.00,
                        category: "produto",
                        emoji: "🍰",
                        description: "Bolo de chocolate caseiro",
                        available: true,
                        stock: 5,
                        createdAt: new Date()
                    }
                ],
                reservations: [],
                appointments: []
            },
            {
                id: 2,
                name: "Boutique Maria",
                category: "moda",
                categories: ["Roupas Femininas", "Acessórios", "Bolsas", "Sapatos"],
                address: "Av. Principal, 456, Vila Nova",
                neighborhood: "Vila Nova",
                zone: "Zona Sul",
                state: "SP",
                phone: "(11) 88888-8888",
                description: "Boutique especializada em moda feminina e acessórios",
                distance: "300m",
                rating: 4.7,
                emoji: "👗",
                status: "approved",
                merchantId: 2,
                views: 189,
                contacts: 8,
                likes: 23,
                products: [
                    {
                        id: 3,
                        name: "Vestido Floral",
                        price: 89.90,
                        category: "produto",
                        emoji: "👗",
                        description: "Vestido floral primavera/verão",
                        available: true,
                        stock: 3,
                        createdAt: new Date()
                    },
                    {
                        id: 4,
                        name: "Bolsa de Couro",
                        price: 120.00,
                        category: "produto",
                        emoji: "👜",
                        description: "Bolsa de couro legítimo",
                        available: true,
                        stock: 2,
                        createdAt: new Date()
                    }
                ],
                reservations: [],
                appointments: []
            },
            {
                id: 3,
                name: "Salão Beleza & Estilo",
                category: "beleza",
                categories: ["Manicure", "Pedicure", "Pé e Mão Completo"],
                address: "Rua da Beleza, 789, Centro",
                neighborhood: "Centro",
                zone: "Centro",
                state: "SP",
                phone: "(11) 77777-7777",
                description: "Cuidados completos para suas unhas",
                distance: "200m",
                rating: 4.9,
                emoji: "💅",
                status: "approved",
                merchantId: 3,
                views: 156,
                contacts: 18,
                likes: 32,
                products: [
                    {
                        id: 5,
                        name: "Manicure",
                        price: 25.00,
                        category: "servico",
                        emoji: "💅",
                        description: "Manicure completa com esmaltação",
                        available: true,
                        duration: "45min",
                        createdAt: new Date()
                    },
                    {
                        id: 6,
                        name: "Pedicure",
                        price: 30.00,
                        category: "servico",
                        emoji: "🦶",
                        description: "Pedicure completa com esmaltação",
                        available: true,
                        duration: "1h",
                        createdAt: new Date()
                    },
                    {
                        id: 7,
                        name: "Pé e Mão Completo",
                        price: 50.00,
                        category: "servico",
                        emoji: "✨",
                        description: "Manicure + Pedicure completas",
                        available: true,
                        duration: "1h30min",
                        createdAt: new Date()
                    }
                ],
                reservations: [],
                appointments: [],
                calendar: {
                    "2024-12-20": [
                        { id: 1, time: "09:00", serviceId: 5, serviceName: "Manicure", price: 25.00, available: true, customerId: null },
                        { id: 2, time: "10:00", serviceId: 6, serviceName: "Pedicure", price: 30.00, available: true, customerId: null },
                        { id: 3, time: "11:00", serviceId: 7, serviceName: "Pé e Mão Completo", price: 50.00, available: true, customerId: null },
                        { id: 4, time: "14:00", serviceId: 5, serviceName: "Manicure", price: 25.00, available: true, customerId: null },
                        { id: 5, time: "15:00", serviceId: 6, serviceName: "Pedicure", price: 30.00, available: true, customerId: null }
                    ],
                    "2024-12-21": [
                        { id: 6, time: "09:00", serviceId: 7, serviceName: "Pé e Mão Completo", price: 50.00, available: true, customerId: null },
                        { id: 7, time: "11:00", serviceId: 5, serviceName: "Manicure", price: 25.00, available: true, customerId: null },
                        { id: 8, time: "14:00", serviceId: 6, serviceName: "Pedicure", price: 30.00, available: true, customerId: null },
                        { id: 9, time: "15:30", serviceId: 5, serviceName: "Manicure", price: 25.00, available: true, customerId: null }
                    ]
                }
            }
        ];

        let merchants = [
            {
                id: 1,
                name: "João Silva",
                email: "joao@padaria.com",
                password: "123456",
                phone: "(11) 99999-9999",
                document: "12.345.678/0001-90",
                storeName: "Padaria Pão Quente",
                address: "Rua das Flores, 123, Centro",
                status: "approved"
            },
            {
                id: 2,
                name: "Maria Santos",
                email: "maria@boutique.com",
                password: "123456",
                phone: "(11) 88888-8888",
                document: "98.765.432/0001-10",
                storeName: "Boutique Maria",
                address: "Av. Principal, 456, Vila Nova",
                status: "approved"
            },
            {
                id: 3,
                name: "Ana Silva",
                email: "ana@salao.com",
                password: "123456",
                phone: "(11) 77777-7777",
                document: "11.222.333/0001-44",
                storeName: "Salão Beleza & Estilo",
                address: "Rua da Beleza, 789, Centro",
                status: "approved"
            }
        ];

        let customers = [
            {
                id: 1,
                name: "Ana Costa",
                email: "ana@email.com",
                password: "123456",
                phone: "(11) 99999-0000",
                favoriteStores: [1],
                likedStores: [1],
                appointments: [],
                reservations: []
            },
            {
                id: 2,
                name: "Cliente Teste",
                email: "cliente@teste.com",
                password: "123456",
                phone: "(11) 98765-4321",
                favoriteStores: [2],
                likedStores: [2],
                appointments: [],
                reservations: []
            }
        ];

        let news = [
            {
                id: 1,
                title: "🎉 Bem-vindos ao Meu Bairro!",
                content: "Estamos felizes em conectar você com os melhores negócios do seu bairro. Descubra lojas incríveis perto de você!",
                date: new Date().toISOString(),
                publishedAt: new Date(),
                media: "🎉",
                type: "text",
                likes: 12,
                dislikes: 1,
                duration: 24,
                authorType: 'admin',
                viewed: false
            },
            {
                id: 2,
                title: "🍕 Nova Pizzaria no Bairro!",
                content: "A Pizzaria Bella Vista acaba de abrir suas portas! Experimente nossos sabores únicos e massa artesanal.",
                date: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
                publishedAt: new Date(Date.now() - 2 * 60 * 60 * 1000),
                media: "🍕",
                type: "text",
                likes: 8,
                dislikes: 0,
                duration: 24,
                authorType: 'merchant',
                viewed: false
            },
            {
                id: 3,
                title: "💄 Promoção Especial!",
                content: "Boutique Maria está com 30% de desconto em toda linha de cosméticos! Válido até domingo.",
                date: new Date(Date.now() - 4 * 60 * 60 * 1000).toISOString(),
                publishedAt: new Date(Date.now() - 4 * 60 * 60 * 1000),
                media: "💄",
                type: "text",
                likes: 15,
                dislikes: 0,
                duration: 24,
                authorType: 'merchant',
                viewed: false
            }
        ];

        let currentUser = null;
        let currentCategory = 'todos';
        let filteredStores = [...stores];

        // Authentication functions
        function login(email, password, type) {
            // Admin login
            if (type === 'admin' && email === 'admin@app.com' && password === 'admin123') {
                currentUser = { id: 0, name: 'Administrador', email: email, type: 'admin' };
                showAdminPanel();
                hideAllModals();
                return true;
            }
            
            // Merchant login
            if (type === 'merchant') {
                const merchant = merchants.find(m => m.email === email && m.password === password);
                if (merchant) {
                    currentUser = { ...merchant, type: 'merchant' };
                    showMerchantPanel();
                    hideAllModals();
                    return true;
                }
            }
            
            // Customer login
            if (type === 'customer') {
                const customer = customers.find(c => c.email === email && c.password === password);
                if (customer) {
                    currentUser = { ...customer, type: 'customer' };
                    showCustomerView();
                    hideAllModals();
                    return true;
                }
            }
            
            return false;
        }

        function logout() {
            currentUser = null;
            showPublicView();
        }

        function register(name, email, password, confirmPassword, phone, document, storeName, address) {
            if (password !== confirmPassword) {
                alert('As senhas não coincidem!');
                return;
            }
            
            if (merchants.find(m => m.email === email)) {
                alert('Este email já está cadastrado!');
                return;
            }
            
            const newMerchant = {
                id: merchants.length + 1,
                name,
                email,
                password,
                phone,
                document,
                storeName,
                address,
                status: 'pending'
            };
            
            merchants.push(newMerchant);
            
            const newStore = {
                id: stores.length + 1,
                name: storeName,
                category: "servicos",
                categories: [],
                address: address,
                neighborhood: "",
                zone: "",
                state: "",
                phone: phone,
                description: "Nova loja cadastrada",
                distance: "0m",
                rating: 5.0,
                emoji: "🏪",
                status: "pending",
                merchantId: newMerchant.id,
                views: 0,
                contacts: 0,
                products: []
            };
            
            stores.push(newStore);
            
            alert('Cadastro realizado com sucesso! Aguarde a aprovação do administrador.');
            showLoginModal();
        }

        function registerCustomer(name, email, password) {
            if (customers.find(c => c.email === email)) {
                alert('Este email já está cadastrado!');
                return;
            }
            
            const newCustomer = {
                id: customers.length + 1,
                name,
                email,
                password,
                phone: document.getElementById('customerRegisterPhone').value,
                favoriteStores: []
            };
            
            customers.push(newCustomer);
            
            alert('Cadastro realizado com sucesso! Faça login para continuar.');
            showLoginModal();
        }

        // View functions
        function showPublicView() {
            document.getElementById('publicView').classList.remove('hidden');
            document.getElementById('adminPanel').classList.add('hidden');
            document.getElementById('merchantPanel').classList.add('hidden');
            document.getElementById('customerSidebar').classList.add('hidden');
            document.getElementById('sidebarOverlay').classList.add('hidden');
            
            // Hide all panel buttons first
            document.getElementById('adminPanelButton').classList.add('hidden');
            document.getElementById('merchantPanelButton').classList.add('hidden');
            document.getElementById('customerMenuButton').classList.add('hidden');
            document.getElementById('loginButton').classList.add('hidden');
            
            // Show appropriate buttons based on user type
            if (currentUser) {
                if (currentUser.type === 'admin') {
                    document.getElementById('adminPanelButton').classList.remove('hidden');
                } else if (currentUser.type === 'merchant') {
                    document.getElementById('merchantPanelButton').classList.remove('hidden');
                } else if (currentUser.type === 'customer') {
                    document.getElementById('customerMenuButton').classList.remove('hidden');
                    document.getElementById('customerHeaderName').textContent = currentUser.name;
                    document.getElementById('customerSidebarName').textContent = currentUser.name;
                }
            } else {
                document.getElementById('loginButton').classList.remove('hidden');
            }
            
            updateAppDisplay();
            renderCategories();
            renderStores();
            renderNews();
            populateLocationFilters();
        }

        function showAdminPanel() {
            document.getElementById('publicView').classList.add('hidden');
            document.getElementById('adminPanel').classList.remove('hidden');
            document.getElementById('merchantPanel').classList.add('hidden');
            updateAdminStats();
        }

        function showMerchantPanel() {
            document.getElementById('publicView').classList.add('hidden');
            document.getElementById('adminPanel').classList.add('hidden');
            document.getElementById('merchantPanel').classList.remove('hidden');
            
            const store = stores.find(s => s.merchantId === currentUser.id);
            if (store) {
                document.getElementById('merchantStoreName').textContent = store.name;
                document.getElementById('storeViews').textContent = store.views;
                document.getElementById('storeRating').textContent = store.rating;
                document.getElementById('storeContacts').textContent = store.contacts;
            }
        }

        function showCustomerView() {
            showPublicView(); // This will handle all the button visibility logic
        }

        function showCustomerPanel() {
            document.getElementById('publicView').classList.add('hidden');
            document.getElementById('adminPanel').classList.add('hidden');
            document.getElementById('merchantPanel').classList.add('hidden');
            document.getElementById('customerPanel').classList.remove('hidden');
            
            document.getElementById('customerPanelName').textContent = currentUser.name;
            updateCustomerStats();
        }

        function updateCustomerStats() {
            if (!currentUser || currentUser.type !== 'customer') return;
            
            // Count appointments
            let appointmentsCount = 0;
            stores.forEach(store => {
                if (store.appointments) {
                    appointmentsCount += store.appointments.filter(apt => apt.customerId === currentUser.id).length;
                }
            });
            
            // Count reservations
            let reservationsCount = 0;
            stores.forEach(store => {
                if (store.reservations) {
                    reservationsCount += store.reservations.filter(res => res.customerId === currentUser.id).length;
                }
            });
            
            document.getElementById('customerAppointments').textContent = appointmentsCount;
            document.getElementById('customerReservations').textContent = reservationsCount;
            document.getElementById('customerFavorites').textContent = currentUser.favoriteStores?.length || 0;
            document.getElementById('customerRatings').textContent = currentUser.likedStores?.length || 0;
        }

        function toggleStoreLike(storeId) {
            if (!currentUser || currentUser.type !== 'customer') {
                alert('Faça login como cliente para curtir comerciantes.');
                showLoginModal();
                return;
            }
            
            const store = stores.find(s => s.id === storeId);
            if (!store) return;
            
            if (!currentUser.likedStores) currentUser.likedStores = [];
            if (!store.likes) store.likes = 0;
            
            const isLiked = currentUser.likedStores.includes(storeId);
            
            if (isLiked) {
                // Remove like
                currentUser.likedStores = currentUser.likedStores.filter(id => id !== storeId);
                store.likes = Math.max(0, store.likes - 1);
            } else {
                // Add like
                currentUser.likedStores.push(storeId);
                store.likes++;
            }
            
            // Update merchant stats if they're viewing their panel
            if (currentUser.type === 'merchant' && currentUser.id === store.merchantId) {
                const likesElement = document.getElementById('storeLikes');
                if (likesElement) {
                    likesElement.textContent = store.likes;
                }
            }
            
            // Re-render stores to update like button
            renderStores();
            updateCustomerStats();
        }

        function updateAppDisplay() {
            document.getElementById('appTitle').textContent = appSettings.name;
            document.getElementById('appSlogan').textContent = appSettings.slogan;
            
            const appLogo = document.getElementById('appLogo');
            const loginLogo = document.getElementById('loginLogo');
            
            if (appSettings.logo.type === 'text') {
                appLogo.innerHTML = appSettings.logo.content;
                appLogo.className = "w-20 h-20 bg-white/20 rounded-full flex items-center justify-center text-2xl font-bold mr-4 shadow-lg";
                loginLogo.innerHTML = appSettings.logo.content;
            } else if (appSettings.logo.type === 'image') {
                appLogo.innerHTML = `<img src="${appSettings.logo.content}" class="logo-preview rounded-full w-full h-full object-cover">`;
                appLogo.className = "w-20 h-20 bg-white/20 rounded-full flex items-center justify-center mr-4 shadow-lg overflow-hidden";
                loginLogo.innerHTML = `<img src="${appSettings.logo.content}" class="logo-preview rounded-full w-full h-full object-cover">`;
            }
        }

        function updateAdminStats() {
            document.getElementById('totalStores').textContent = stores.length;
            document.getElementById('totalMerchants').textContent = merchants.length;
            document.getElementById('totalCustomers').textContent = customers.length;
            document.getElementById('totalPending').textContent = merchants.filter(m => m.status === 'pending').length;
        }

        // Modal functions
        function hideAllModals() {
            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('forgotPasswordModal').classList.add('hidden');
            document.getElementById('registerModal').classList.add('hidden');
            document.getElementById('customerRegisterModal').classList.add('hidden');
        }

        function showLoginModal() {
            hideAllModals();
            document.getElementById('loginModal').classList.remove('hidden');
        }

        function showForgotPasswordForm() {
            hideAllModals();
            document.getElementById('forgotPasswordModal').classList.remove('hidden');
            document.getElementById('forgotPasswordModal').classList.add('flex');
        }

        function showRegisterForm() {
            hideAllModals();
            document.getElementById('registerModal').classList.remove('hidden');
            document.getElementById('registerModal').classList.add('flex');
        }

        function showCustomerRegisterForm() {
            hideAllModals();
            document.getElementById('customerRegisterModal').classList.remove('hidden');
            document.getElementById('customerRegisterModal').classList.add('flex');
        }

        // Sidebar functions
        function openSidebar() {
            document.getElementById('customerSidebar').classList.remove('hidden');
            document.getElementById('sidebarOverlay').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('customerSidebar').style.transform = 'translateX(0)';
            }, 10);
        }

        function closeSidebar() {
            document.getElementById('customerSidebar').style.transform = 'translateX(-100%)';
            setTimeout(() => {
                document.getElementById('customerSidebar').classList.add('hidden');
                document.getElementById('sidebarOverlay').classList.add('hidden');
            }, 300);
        }

        // Location filter functions
        function updateLocationFilters() {
            const selectedState = document.getElementById('stateFilter').value;
            const selectedZone = document.getElementById('zoneFilter').value;
            
            const zoneFilter = document.getElementById('zoneFilter');
            const neighborhoodFilter = document.getElementById('neighborhoodFilter');
            
            if (selectedState) {
                const zones = [...new Set(stores.filter(s => s.state === selectedState).map(s => s.zone).filter(Boolean))];
                zoneFilter.innerHTML = '<option value="">Zona</option>' + 
                    zones.map(z => `<option value="${z}" ${z === selectedZone ? 'selected' : ''}>${z}</option>`).join('');
            } else {
                const zones = [...new Set(stores.map(s => s.zone).filter(Boolean))];
                zoneFilter.innerHTML = '<option value="">Zona</option>' + 
                    zones.map(z => `<option value="${z}">${z}</option>`).join('');
            }
            
            let neighborhoodStores = stores;
            if (selectedState) {
                neighborhoodStores = neighborhoodStores.filter(s => s.state === selectedState);
            }
            if (selectedZone) {
                neighborhoodStores = neighborhoodStores.filter(s => s.zone === selectedZone);
            }
            
            const neighborhoods = [...new Set(neighborhoodStores.map(s => s.neighborhood).filter(Boolean))];
            neighborhoodFilter.innerHTML = '<option value="">Bairro</option>' + 
                neighborhoods.map(n => `<option value="${n}">${n}</option>`).join('');
            
            filterByLocation();
        }

        function filterByLocation() {
            const state = document.getElementById('stateFilter').value;
            const zone = document.getElementById('zoneFilter').value;
            const neighborhood = document.getElementById('neighborhoodFilter').value;
            
            let filtered = [...stores];
            
            if (state) {
                filtered = filtered.filter(s => s.state === state);
            }
            
            if (zone) {
                filtered = filtered.filter(s => s.zone === zone);
            }
            
            if (neighborhood) {
                filtered = filtered.filter(s => s.neighborhood === neighborhood);
            }
            
            if (currentCategory !== 'todos') {
                filtered = filtered.filter(s => s.category === currentCategory);
            }
            
            filteredStores = filtered;
            renderStores();
        }

        function populateLocationFilters() {
            const states = [...new Set(stores.map(s => s.state).filter(Boolean))].sort();
            const zones = [...new Set(stores.map(s => s.zone).filter(Boolean))].sort();
            const neighborhoods = [...new Set(stores.map(s => s.neighborhood).filter(Boolean))].sort();
            
            const stateFilter = document.getElementById('stateFilter');
            const zoneFilter = document.getElementById('zoneFilter');
            const neighborhoodFilter = document.getElementById('neighborhoodFilter');
            
            if (stateFilter) {
                stateFilter.innerHTML = '<option value="">Estado</option>' +
                    states.map(s => `<option value="${s}">${s}</option>`).join('');
            }
            
            if (zoneFilter) {
                zoneFilter.innerHTML = '<option value="">Zona</option>' +
                    zones.map(z => `<option value="${z}">${z}</option>`).join('');
            }
            
            if (neighborhoodFilter) {
                neighborhoodFilter.innerHTML = '<option value="">Bairro</option>' +
                    neighborhoods.map(n => `<option value="${n}">${n}</option>`).join('');
            }
        }

        // Render functions
        function renderCategories() {
            const categoriesContainer = document.getElementById('categories');
            if (!categoriesContainer) return;
            
            categoriesContainer.innerHTML = availableCategories.map(category => `
                <button class="category-btn ${category.id === currentCategory ? 'active' : ''} px-6 py-3 rounded-full bg-gray-100 text-gray-700 font-medium flex items-center gap-2" data-category="${category.id}">
                    ${category.type === 'image' ? 
                        `<img src="${category.emoji}" class="w-6 h-6 rounded-full object-cover">` :
                        `<span>${category.emoji}</span>`
                    }
                    <span>${category.name}</span>
                </button>
            `).join('');
            
            // Add event listeners
            categoriesContainer.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    filterByCategory(btn.dataset.category);
                });
            });
        }

        function renderStores(storesToRender = filteredStores.filter(s => s.status === 'approved')) {
            const grid = document.getElementById('storesGrid');
            if (!grid) return;
            grid.innerHTML = '';

            storesToRender.forEach(store => {
                const storeCard = document.createElement('div');
                storeCard.className = 'store-card rounded-2xl p-6 text-white cursor-pointer';
                
                storeCard.innerHTML = `
                    <div class="flex items-start justify-between mb-4">
                        <div class="w-16 h-16 rounded-lg overflow-hidden bg-white/20 flex items-center justify-center">
                            ${store.logo ? 
                                `<img src="${store.logo}" class="w-full h-full object-cover">` :
                                `<span class="text-4xl">${store.emoji}</span>`
                            }
                        </div>
                        <div class="text-right">
                            <div class="text-sm opacity-80">${store.distance}</div>
                            <div class="flex items-center">
                                <span class="text-yellow-300">⭐</span>
                                <span class="ml-1 text-sm">${store.rating}</span>
                            </div>
                        </div>
                    </div>
                    <h3 class="text-xl font-bold mb-2">${store.name}</h3>
                    <p class="text-sm opacity-90 mb-3">${store.description}</p>
                    
                    <div class="mb-3">
                        <div class="flex flex-wrap gap-1">
                            ${store.categories?.slice(0, 3).map(cat => `
                                <span class="category-tag bg-white/20 text-white text-xs">${cat}</span>
                            `).join('') || ''}
                            ${store.categories?.length > 3 ? `<span class="category-tag bg-white/20 text-white text-xs">+${store.categories.length - 3}</span>` : ''}
                        </div>
                    </div>
                    
                    <div class="space-y-1 text-sm opacity-80">
                        <div class="flex items-center">
                            <span class="mr-2">📍</span>
                            <span>${store.neighborhood}, ${store.zone} - ${store.state}</span>
                        </div>
                        ${store.phone ? `
                        <div class="flex items-center">
                            <span class="mr-2">📞</span>
                            <span>${store.phone}</span>
                        </div>
                        ` : ''}
                        ${store.paymentMethods && (store.paymentMethods.cards?.length > 0 || store.paymentMethods.others?.length > 0) ? `
                        <div class="flex items-center">
                            <span class="mr-2">💳</span>
                            <span class="text-xs">
                                ${store.paymentMethods.cards?.slice(0, 3).map(cardId => {
                                    const card = getAvailableCards().find(c => c.id === cardId);
                                    return card ? card.name : cardId;
                                }).join(', ') || ''}
                                ${store.paymentMethods.others?.includes('pix') ? (store.paymentMethods.cards?.length > 0 ? ', PIX' : 'PIX') : ''}
                                ${store.paymentMethods.others?.includes('dinheiro') ? ', Dinheiro' : ''}
                                ${(store.paymentMethods.cards?.length || 0) + (store.paymentMethods.others?.length || 0) > 4 ? '...' : ''}
                            </span>
                        </div>
                        ` : ''}
                    </div>
                    <div class="mt-4 pt-4 border-t border-white/20 flex gap-2">
                        <button onclick="viewStoreDetails(${store.id})" class="flex-1 bg-white/20 hover:bg-white/30 py-2 rounded-lg transition-colors">
                            Ver Detalhes
                        </button>
                        ${currentUser && currentUser.type === 'customer' ? `
                            <button onclick="toggleStoreLike(${store.id})" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-colors ${currentUser.likedStores?.includes(store.id) ? 'bg-yellow-400/30' : ''}">
                                ⭐ ${store.likes || 0}
                            </button>
                        ` : `
                            <div class="bg-white/20 px-4 py-2 rounded-lg">
                                ⭐ ${store.likes || 0}
                            </div>
                        `}
                        <button onclick="openMaps('${store.address}')" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-colors">
                            📍
                        </button>
                    </div>
                `;
                
                grid.appendChild(storeCard);
            });
        }

        function renderNews() {
            renderStories();
            renderTraditionalNews();
        }

        function renderStories() {
            const storiesContainer = document.getElementById('storiesContainer');
            if (!storiesContainer) return;
            
            // Filter active stories (within duration)
            const activeStories = news.filter(story => {
                const hoursAgo = (new Date() - new Date(story.publishedAt)) / (1000 * 60 * 60);
                return hoursAgo < story.duration;
            });
            
            if (activeStories.length === 0) {
                storiesContainer.innerHTML = '<p class="text-gray-500 text-center w-full py-8">Nenhum story ativo no momento</p>';
                return;
            }
            
            storiesContainer.innerHTML = activeStories.map((story, index) => {
                const hoursAgo = (new Date() - new Date(story.publishedAt)) / (1000 * 60 * 60);
                const progressPercent = (hoursAgo / story.duration) * 100;
                
                return `
                    <div class="story-container min-w-[200px] h-[300px] bg-gradient-to-br from-purple-500 to-pink-500 relative" onclick="openStory(${index})">
                        <div class="story-progress">
                            <div class="story-progress-bar" style="width: ${progressPercent}%; animation-duration: ${(story.duration - hoursAgo) * 3600}s;"></div>
                        </div>
                        
                        ${story.type === 'image' ? `
                            <img src="${story.media}" class="w-full h-full object-cover">
                        ` : story.type === 'video' ? `
                            <video class="w-full h-full object-cover" muted>
                                <source src="${story.media}" type="video/mp4">
                            </video>
                        ` : `
                            <div class="w-full h-full flex items-center justify-center text-white text-6xl">
                                ${story.media}
                            </div>
                        `}
                        
                        <div class="story-overlay">
                            <div class="flex items-center mb-2">
                                <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center text-sm mr-2">
                                    ${story.authorType === 'admin' ? '👨‍💼' : story.authorType === 'merchant' ? '🏪' : '👤'}
                                </div>
                                <span class="text-sm opacity-90">${story.authorType === 'admin' ? 'Administração' : story.authorType === 'merchant' ? 'Lojista' : 'Cliente'}</span>
                            </div>
                            <h4 class="font-bold text-sm mb-1">${story.title}</h4>
                            <p class="text-xs opacity-80 line-clamp-2">${story.content}</p>
                            <div class="flex items-center justify-between mt-2 text-xs">
                                <span>${Math.floor(story.duration - hoursAgo)}h restantes</span>
                                <div class="flex gap-2">
                                    <span>👍 ${story.likes}</span>
                                    <span>👁️ ${story.views || 0}</span>
                                </div>
                            </div>
                        </div>
                        
                        ${!story.viewed ? '<div class="absolute top-2 right-2 w-3 h-3 bg-blue-500 rounded-full border-2 border-white"></div>' : ''}
                    </div>
                `;
            }).join('');
        }

        function renderTraditionalNews() {
            const newsGrid = document.getElementById('newsGrid');
            if (!newsGrid) return;
            
            // Show older news as traditional cards
            const olderNews = news.filter(item => {
                const hoursAgo = (new Date() - new Date(item.publishedAt)) / (1000 * 60 * 60);
                return hoursAgo >= item.duration;
            });
            
            newsGrid.innerHTML = olderNews.map(item => `
                <div class="bg-white rounded-xl p-6 shadow-lg hover:shadow-xl transition-shadow">
                    <div class="flex items-center mb-4">
                        <div class="w-16 h-16 mr-3 rounded-lg overflow-hidden bg-gray-100 flex items-center justify-center">
                            ${item.type === 'image' ? `
                                <img src="${item.media}" class="w-full h-full object-cover">
                            ` : `
                                <span class="text-3xl">${item.media}</span>
                            `}
                        </div>
                        <div class="flex-1">
                            <h3 class="font-bold text-lg">${item.title}</h3>
                            <div class="flex items-center text-sm text-gray-500">
                                <span>📅 ${new Date(item.publishedAt).toLocaleDateString('pt-BR')}</span>
                            </div>
                        </div>
                    </div>
                    
                    <p class="text-gray-600 mb-4">${item.content}</p>
                    
                    <div class="flex items-center justify-between pt-4 border-t">
                        <div class="flex gap-4">
                            <button onclick="likeNews(${item.id})" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-green-50 transition-colors text-gray-600">
                                <span class="text-lg">👍</span>
                                <span class="text-sm font-medium">${item.likes || 0}</span>
                            </button>
                            <button onclick="dislikeNews(${item.id})" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-red-50 transition-colors text-gray-600">
                                <span class="text-lg">👎</span>
                                <span class="text-sm font-medium">${item.dislikes || 0}</span>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Store interaction functions
        function viewStoreDetails(storeId) {
            const store = stores.find(s => s.id === storeId);
            if (!store) return;
            
            store.views++;
            
            // Create detailed modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">🏪 ${store.name}</h2>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">×</button>
                    </div>
                    
                    <div class="flex items-center mb-6">
                        <div class="w-20 h-20 rounded-lg overflow-hidden bg-gray-100 flex items-center justify-center mr-4">
                            ${store.logo ? 
                                `<img src="${store.logo}" class="w-full h-full object-cover">` :
                                `<span class="text-4xl">${store.emoji}</span>`
                            }
                        </div>
                        <div class="flex-1">
                            <p class="text-gray-600 mb-2">${store.description}</p>
                            <div class="flex items-center gap-4 text-sm text-gray-600">
                                <span class="flex items-center"><span class="text-yellow-500">⭐</span> ${store.rating}</span>
                                <span class="flex items-center">👁️ ${store.views} visualizações</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-4 mb-6">
                        <div class="flex items-center">
                            <span class="mr-3">📍</span>
                            <span>${store.address}</span>
                        </div>
                        <div class="flex items-center">
                            <span class="mr-3">📞</span>
                            <span>${store.phone}</span>
                        </div>
                        <div class="flex items-center">
                            <span class="mr-3">🏷️</span>
                            <span>${store.categories?.join(', ') || 'Sem especialidades'}</span>
                        </div>
                    </div>
                    
                    <!-- Formas de Pagamento -->
                    ${store.paymentMethods && (store.paymentMethods.cards?.length > 0 || store.paymentMethods.others?.length > 0 || store.paymentMethods.agreements?.length > 0 || store.paymentMethods.customAgreements?.length > 0) ? `
                        <div class="mb-6">
                            <h3 class="text-lg font-bold mb-4">💳 Formas de Pagamento Aceitas</h3>
                            <div class="space-y-4">
                                ${store.paymentMethods.cards?.length > 0 ? `
                                    <div>
                                        <h4 class="font-medium text-gray-700 mb-2">Cartões</h4>
                                        <div class="flex flex-wrap gap-2">
                                            ${store.paymentMethods.cards.map(cardId => {
                                                const card = getAvailableCards().find(c => c.id === cardId);
                                                return card ? `<img src="${card.logo}" alt="${card.name}" class="h-6 rounded border">` : '';
                                            }).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                                ${store.paymentMethods.others?.length > 0 ? `
                                    <div>
                                        <h4 class="font-medium text-gray-700 mb-2">Outros</h4>
                                        <div class="flex flex-wrap gap-2">
                                            ${store.paymentMethods.others.map(methodId => {
                                                const method = getOtherPaymentMethods().find(m => m.id === methodId);
                                                return method ? `<span class="bg-gray-100 px-3 py-1 rounded-full text-sm flex items-center gap-1">${method.icon} ${method.name}</span>` : '';
                                            }).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                                ${store.paymentMethods.agreements?.length > 0 ? `
                                    <div>
                                        <h4 class="font-medium text-gray-700 mb-2">Convênios</h4>
                                        <div class="flex flex-wrap gap-2">
                                            ${store.paymentMethods.agreements.map(agreementId => {
                                                const agreement = getAvailableAgreements().find(a => a.id === agreementId);
                                                return agreement ? `<span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm flex items-center gap-1">${agreement.icon} ${agreement.name}</span>` : '';
                                            }).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                                ${store.paymentMethods.customAgreements?.length > 0 ? `
                                    <div>
                                        <h4 class="font-medium text-gray-700 mb-2">Convênios Personalizados</h4>
                                        <div class="flex flex-wrap gap-2">
                                            ${store.paymentMethods.customAgreements.map(agreement => 
                                                `<span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm flex items-center gap-1">🏢 ${agreement.name}</span>`
                                            ).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    ` : ''}
                    
                    ${store.products && store.products.length > 0 ? `
                        <div class="mb-6">
                            <h3 class="text-lg font-bold mb-4">📦 Produtos e Serviços</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                ${store.products.filter(p => p.available).slice(0, 6).map(product => `
                                    <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                                        <div class="flex items-center mb-2">
                                            ${product.image ? 
                                                `<img src="${product.image}" class="w-10 h-10 rounded-lg object-cover mr-3">` :
                                                `<span class="text-2xl mr-3">${product.emoji}</span>`
                                            }
                                            <div class="flex-1">
                                                <h4 class="font-medium">${product.name}</h4>
                                                <div class="flex items-center gap-2">
                                                    <p class="text-green-600 font-bold">R$ ${product.price.toFixed(2)}</p>
                                                    ${product.duration ? `<span class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded">⏱️ ${product.duration}</span>` : ''}
                                                </div>
                                            </div>
                                        </div>
                                        ${product.description ? `<p class="text-sm text-gray-600">${product.description}</p>` : ''}
                                        ${currentUser && currentUser.type === 'customer' ? `
                                            <button onclick="bookService(${store.id}, ${product.id})" class="mt-2 w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                                ${product.category === 'servico' ? 'Agendar' : 'Reservar'}
                                            </button>
                                        ` : ''}
                                    </div>
                                `).join('')}
                            </div>
                            ${store.products.length > 6 ? `<p class="text-center text-gray-500 mt-4">... e mais ${store.products.length - 6} itens</p>` : ''}
                        </div>
                    ` : ''}
                    
                    <div class="flex gap-4">
                        <button onclick="openMaps('${store.address}')" class="flex-1 bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors">
                            📍 Ver no Mapa
                        </button>
                        <button onclick="contactStore(${store.id})" class="flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors">
                            📞 Entrar em Contato
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Update views in merchant panel if current user is the merchant
            if (currentUser && currentUser.type === 'merchant' && currentUser.id === store.merchantId) {
                const viewsElement = document.getElementById('storeViews');
                if (viewsElement) {
                    viewsElement.textContent = store.views;
                }
            }
        }
        
        function contactStore(storeId) {
            const store = stores.find(s => s.id === storeId);
            if (store) {
                store.contacts++;
                
                // Update contacts in merchant panel if current user is the merchant
                if (currentUser && currentUser.type === 'merchant' && currentUser.id === store.merchantId) {
                    const contactsElement = document.getElementById('storeContacts');
                    if (contactsElement) {
                        contactsElement.textContent = store.contacts;
                    }
                }
                
                const whatsappNumber = store.phone.replace(/\D/g, '');
                const message = encodeURIComponent(`Olá! Vi sua loja "${store.name}" no app Meu Bairro e gostaria de mais informações.`);
                window.open(`https://wa.me/55${whatsappNumber}?text=${message}`, '_blank');
            }
        }
        
        function bookService(storeId, productId) {
            const store = stores.find(s => s.id == storeId);
            const product = store.products.find(p => p.id == productId);
            
            if (!currentUser || currentUser.type !== 'customer') {
                alert('Faça login como cliente para agendar serviços.');
                showLoginModal();
                return;
            }
            
            if (product.category === 'servico') {
                // Show booking modal for services
                showBookingModal(store, product);
            } else {
                // Simple reservation for products
                showProductReservationModal(store, product);
            }
        }
        
        function showProductReservationModal(store, product) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold">🛒 Reservar Produto</h2>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">×</button>
                    </div>
                    
                    <div class="text-center mb-6">
                        <div class="w-20 h-20 mx-auto mb-4 rounded-lg overflow-hidden bg-gray-100 flex items-center justify-center">
                            ${product.image ? 
                                `<img src="${product.image}" class="w-full h-full object-cover">` :
                                `<span class="text-3xl">${product.emoji}</span>`
                            }
                        </div>
                        <h3 class="text-lg font-bold">${product.name}</h3>
                        <p class="text-green-600 font-bold text-xl">R$ ${product.price.toFixed(2)}</p>
                        <p class="text-gray-600">🏪 ${store.name}</p>
                    </div>
                    
                    <form id="productReservationForm">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Quantidade</label>
                                <input type="number" id="reservationQuantity" value="1" min="1" ${product.stock ? `max="${product.stock}"` : ''} class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" required>
                                ${product.stock ? `<p class="text-sm text-gray-500 mt-1">Estoque disponível: ${product.stock}</p>` : ''}
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Data para retirada</label>
                                <input type="date" id="reservationDate" min="${new Date().toISOString().split('T')[0]}" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" required>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Observações (opcional)</label>
                                <textarea id="reservationNotes" class="w-full px-4 py-2 border rounded-lg h-20 focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Alguma observação especial..."></textarea>
                            </div>
                        </div>
                        <div class="mt-6 flex gap-3">
                            <button type="submit" class="flex-1 bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors">
                                🛒 Confirmar Reserva
                            </button>
                            <button type="button" onclick="this.closest('.fixed').remove()" class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                Cancelar
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            document.getElementById('productReservationForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const quantity = parseInt(document.getElementById('reservationQuantity').value);
                const date = document.getElementById('reservationDate').value;
                const notes = document.getElementById('reservationNotes').value;
                const totalPrice = product.price * quantity;
                
                // Create reservation
                if (!store.reservations) store.reservations = [];
                const reservation = {
                    id: Date.now().toString(),
                    customerId: currentUser.id,
                    customerName: currentUser.name,
                    customerPhone: currentUser.phone,
                    productId: product.id,
                    productName: product.name,
                    quantity: quantity,
                    unitPrice: product.price,
                    totalPrice: totalPrice,
                    pickupDate: date,
                    notes: notes,
                    status: 'pending',
                    createdAt: new Date()
                };
                
                store.reservations.push(reservation);
                
                // Update stock if applicable
                if (product.stock) {
                    product.stock -= quantity;
                    if (product.stock <= 0) {
                        product.available = false;
                    }
                }
                
                modal.remove();
                alert(`Reserva realizada com sucesso!\n\nProduto: ${product.name}\nQuantidade: ${quantity}\nTotal: R$ ${totalPrice.toFixed(2)}\nRetirada: ${new Date(date).toLocaleDateString('pt-BR')}\n\nAguarde a confirmação da loja.`);
                
                // Refresh store details if modal is open
                const storeModal = document.querySelector('.fixed');
                if (storeModal && storeModal.innerHTML.includes(store.name)) {
                    storeModal.remove();
                    viewStoreDetails(store.id);
                }
            });
        }
        
        function showBookingModal(store, service) {
            if (!store.calendar) {
                alert('Esta loja ainda não configurou agenda. Entre em contato diretamente.');
                contactStore(store.id);
                return;
            }
            
            // Get available dates
            const availableDates = Object.keys(store.calendar).filter(date => {
                const slots = store.calendar[date].filter(slot => 
                    slot.available && 
                    (slot.serviceId == service.id || slot.serviceId === 'geral') &&
                    new Date(date) >= new Date().setHours(0,0,0,0)
                );
                return slots.length > 0;
            }).sort();
            
            if (availableDates.length === 0) {
                alert('Não há horários disponíveis para este serviço no momento.');
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold">📅 Agendar ${service.name}</h2>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">×</button>
                    </div>
                    
                    <div class="mb-4">
                        <p class="text-gray-600 mb-2">🏪 ${store.name}</p>
                        <p class="text-green-600 font-bold">💰 R$ ${service.price.toFixed(2)}</p>
                    </div>
                    
                    <form id="bookingForm">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Data</label>
                                <select id="bookingDate" class="w-full px-4 py-2 border rounded-lg" required onchange="updateAvailableTimes()">
                                    <option value="">Selecione uma data</option>
                                    ${availableDates.map(date => 
                                        `<option value="${date}">${new Date(date).toLocaleDateString('pt-BR')}</option>`
                                    ).join('')}
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Horário</label>
                                <select id="bookingTime" class="w-full px-4 py-2 border rounded-lg" required>
                                    <option value="">Primeiro selecione uma data</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Observações (opcional)</label>
                                <textarea id="bookingNotes" class="w-full px-4 py-2 border rounded-lg h-20" placeholder="Alguma observação especial..."></textarea>
                            </div>
                        </div>
                        <button type="submit" class="w-full mt-6 bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors">
                            Confirmar Agendamento
                        </button>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add event listeners
            window.updateAvailableTimes = function() {
                const selectedDate = document.getElementById('bookingDate').value;
                const timeSelect = document.getElementById('bookingTime');
                
                if (!selectedDate) {
                    timeSelect.innerHTML = '<option value="">Primeiro selecione uma data</option>';
                    return;
                }
                
                const availableSlots = store.calendar[selectedDate].filter(slot => 
                    slot.available && 
                    (slot.serviceId == service.id || slot.serviceId === 'geral')
                );
                
                timeSelect.innerHTML = '<option value="">Selecione um horário</option>' +
                    availableSlots.map(slot => 
                        `<option value="${slot.time}">${slot.time}</option>`
                    ).join('');
            };
            
            document.getElementById('bookingForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const date = document.getElementById('bookingDate').value;
                const time = document.getElementById('bookingTime').value;
                const notes = document.getElementById('bookingNotes').value;
                
                // Find and book the slot
                const slot = store.calendar[date].find(s => s.time === time);
                if (slot) {
                    slot.available = false;
                    slot.customerId = currentUser.id;
                    
                    // Create appointment
                    if (!store.appointments) store.appointments = [];
                    const appointment = {
                        id: Date.now().toString(),
                        customerId: currentUser.id,
                        customerName: currentUser.name,
                        customerPhone: currentUser.phone,
                        date: date,
                        time: time,
                        serviceId: service.id,
                        serviceName: service.name,
                        price: service.price,
                        notes: notes,
                        status: 'pending',
                        createdAt: new Date()
                    };
                    
                    store.appointments.push(appointment);
                    
                    modal.remove();
                    alert(`Agendamento realizado com sucesso!\n\nData: ${new Date(date).toLocaleDateString('pt-BR')}\nHorário: ${time}\nServiço: ${service.name}\n\nAguarde a confirmação da loja.`);
                }
            });
        }

        function openMaps(address) {
            const encodedAddress = encodeURIComponent(address);
            const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            if (isMobile) {
                // Try to open in Waze first, then Google Maps
                const wazeUrl = `https://waze.com/ul?q=${encodedAddress}`;
                const googleMapsUrl = `https://maps.google.com/maps?q=${encodedAddress}`;
                
                if (confirm('Abrir no Waze? (Cancelar para Google Maps)')) {
                    window.open(wazeUrl, '_blank');
                } else {
                    window.open(googleMapsUrl, '_blank');
                }
            } else {
                const googleMapsUrl = `https://maps.google.com/maps?q=${encodedAddress}`;
                window.open(googleMapsUrl, '_blank');
            }
        }

        // Stories and News interaction functions
        let currentStoryIndex = 0;
        let storyModal = null;
        let storyTimer = null;

        function openStory(index) {
            const activeStories = news.filter(story => {
                const hoursAgo = (new Date() - new Date(story.publishedAt)) / (1000 * 60 * 60);
                return hoursAgo < story.duration;
            });
            
            if (index >= activeStories.length) return;
            
            currentStoryIndex = index;
            const story = activeStories[index];
            
            // Mark as viewed
            story.viewed = true;
            story.views = (story.views || 0) + 1;
            
            // Create modal
            storyModal = document.createElement('div');
            storyModal.className = 'story-modal';
            storyModal.innerHTML = `
                <button class="story-controls story-prev" onclick="prevStory()" ${index === 0 ? 'style="display:none"' : ''}>‹</button>
                <button class="story-controls story-next" onclick="nextStory()" ${index === activeStories.length - 1 ? 'style="display:none"' : ''}>›</button>
                <button class="story-close" onclick="closeStory()">×</button>
                
                <div class="story-content">
                    <div class="story-progress">
                        <div class="story-progress-bar" style="animation-duration: 5s;"></div>
                    </div>
                    
                    ${story.type === 'image' ? `
                        <img src="${story.media}" alt="${story.title}">
                    ` : story.type === 'video' ? `
                        <video autoplay muted controls>
                            <source src="${story.media}" type="video/mp4">
                        </video>
                    ` : `
                        <div class="w-full h-96 bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white">
                            <div class="text-center">
                                <div class="text-8xl mb-4">${story.media}</div>
                                <h2 class="text-2xl font-bold mb-2">${story.title}</h2>
                                <p class="text-lg opacity-90">${story.content}</p>
                            </div>
                        </div>
                    `}
                    
                    <div class="story-overlay">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center mr-3">
                                    ${story.authorType === 'admin' ? '👨‍💼' : story.authorType === 'merchant' ? '🏪' : '👤'}
                                </div>
                                <div>
                                    <div class="font-medium">${story.authorType === 'admin' ? 'Administração' : story.authorType === 'merchant' ? 'Lojista' : 'Cliente'}</div>
                                    <div class="text-sm opacity-75">${new Date(story.publishedAt).toLocaleString('pt-BR')}</div>
                                </div>
                            </div>
                            <div class="flex gap-4">
                                <button onclick="likeStory(${story.id})" class="flex items-center gap-1 bg-white/20 px-3 py-1 rounded-full">
                                    👍 <span>${story.likes}</span>
                                </button>
                                <span class="flex items-center gap-1 bg-white/20 px-3 py-1 rounded-full">
                                    👁️ <span>${story.views}</span>
                                </span>
                            </div>
                        </div>
                        <h3 class="font-bold text-lg mb-2">${story.title}</h3>
                        <p class="opacity-90">${story.content}</p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(storyModal);
            
            // Auto advance after 5 seconds for text stories
            if (story.type === 'text') {
                storyTimer = setTimeout(() => {
                    if (index < activeStories.length - 1) {
                        nextStory();
                    } else {
                        closeStory();
                    }
                }, 5000);
            }
            
            // Update stories display
            renderStories();
        }

        function closeStory() {
            if (storyModal) {
                storyModal.remove();
                storyModal = null;
            }
            if (storyTimer) {
                clearTimeout(storyTimer);
                storyTimer = null;
            }
        }

        function nextStory() {
            closeStory();
            const activeStories = news.filter(story => {
                const hoursAgo = (new Date() - new Date(story.publishedAt)) / (1000 * 60 * 60);
                return hoursAgo < story.duration;
            });
            
            if (currentStoryIndex < activeStories.length - 1) {
                openStory(currentStoryIndex + 1);
            }
        }

        function prevStory() {
            closeStory();
            if (currentStoryIndex > 0) {
                openStory(currentStoryIndex - 1);
            }
        }

        function likeStory(storyId) {
            const story = news.find(n => n.id === storyId);
            if (story) {
                story.likes = (story.likes || 0) + 1;
                renderNews();
                
                // Update modal if open
                if (storyModal) {
                    const likeButton = storyModal.querySelector(`button[onclick="likeStory(${storyId})"] span`);
                    if (likeButton) {
                        likeButton.textContent = story.likes;
                    }
                }
            }
        }

        function likeNews(newsId) {
            const newsItem = news.find(n => n.id === newsId);
            if (newsItem) {
                newsItem.likes = (newsItem.likes || 0) + 1;
                renderNews();
            }
        }

        function dislikeNews(newsId) {
            const newsItem = news.find(n => n.id === newsId);
            if (newsItem) {
                newsItem.dislikes = (newsItem.dislikes || 0) + 1;
                renderNews();
            }
        }

        // Admin functions
        function showAllStores() {
            const content = document.getElementById('adminContent');
            content.innerHTML = `
                <h3 class="text-xl font-bold mb-4">Todas as Lojas</h3>
                <div class="space-y-4">
                    ${stores.map(store => `
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="flex items-center mb-2">
                                        <span class="text-2xl mr-3">${store.emoji}</span>
                                        <div>
                                            <h4 class="font-bold text-lg">${store.name}</h4>
                                            <p class="text-gray-600">${store.description}</p>
                                        </div>
                                    </div>
                                    <div class="ml-11 space-y-1 text-sm text-gray-600">
                                        <p>📍 ${store.address}</p>
                                        <p>📞 ${store.phone}</p>
                                        <p>👁️ ${store.views} visualizações | 📞 ${store.contacts} contatos</p>
                                        <p>🏷️ ${store.categories?.join(', ') || 'Sem especialidades'}</p>
                                    </div>
                                </div>
                                <div class="text-right ml-4">
                                    <p class="text-sm">⭐ ${store.rating}</p>
                                    <span class="px-2 py-1 rounded text-xs ${
                                        store.status === 'approved' ? 'bg-green-100 text-green-800' : 
                                        store.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : 
                                        'bg-red-100 text-red-800'
                                    }">${store.status}</span>
                                    <div class="mt-2 space-y-1">
                                        ${store.status === 'pending' ? `
                                            <button onclick="approveStore(${store.id})" class="block w-full bg-green-500 text-white px-3 py-1 rounded text-xs hover:bg-green-600">Aprovar</button>
                                            <button onclick="rejectStore(${store.id})" class="block w-full bg-red-500 text-white px-3 py-1 rounded text-xs hover:bg-red-600">Rejeitar</button>
                                        ` : store.status === 'approved' ? `
                                            <button onclick="deactivateStore(${store.id})" class="block w-full bg-yellow-500 text-white px-3 py-1 rounded text-xs hover:bg-yellow-600">Desativar</button>
                                        ` : `
                                            <button onclick="activateStore(${store.id})" class="block w-full bg-green-500 text-white px-3 py-1 rounded text-xs hover:bg-green-600">Ativar</button>
                                        `}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function showMerchants() {
            const pendingMerchants = merchants.filter(m => m.status === 'pending');
            const activeMerchants = merchants.filter(m => m.status === 'approved');
            const inactiveMerchants = merchants.filter(m => m.status === 'rejected' || m.status === 'inactive');
            
            const content = document.getElementById('adminContent');
            content.innerHTML = `
                <h3 class="text-xl font-bold mb-4">Gerenciar Lojistas</h3>
                
                ${pendingMerchants.length > 0 ? `
                <div class="mb-8">
                    <h4 class="text-lg font-semibold mb-4 text-yellow-600">⏳ Aguardando Aprovação (${pendingMerchants.length})</h4>
                    <div class="space-y-4">
                        ${pendingMerchants.map(merchant => `
                            <div class="bg-yellow-50 border border-yellow-200 p-4 rounded-lg">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <h5 class="font-bold text-lg">${merchant.name}</h5>
                                        <div class="space-y-1 text-sm text-gray-600">
                                            <p>📧 ${merchant.email}</p>
                                            <p>📞 ${merchant.phone}</p>
                                            <p>📄 ${merchant.document}</p>
                                            <p>🏪 ${merchant.storeName}</p>
                                            <p>📍 ${merchant.address}</p>
                                        </div>
                                    </div>
                                    <div class="flex gap-2 ml-4">
                                        <button onclick="editMerchant(${merchant.id})" class="bg-blue-500 text-white px-3 py-2 rounded hover:bg-blue-600 text-sm">Editar</button>
                                        <button onclick="approveMerchant(${merchant.id})" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Aprovar</button>
                                        <button onclick="rejectMerchant(${merchant.id})" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">Rejeitar</button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
                
                ${activeMerchants.length > 0 ? `
                <div class="mb-8">
                    <h4 class="text-lg font-semibold mb-4 text-green-600">✅ Lojistas Ativos (${activeMerchants.length})</h4>
                    <div class="space-y-4">
                        ${activeMerchants.map(merchant => `
                            <div class="bg-green-50 border border-green-200 p-4 rounded-lg">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <h5 class="font-bold text-lg">${merchant.name}</h5>
                                        <div class="space-y-1 text-sm text-gray-600">
                                            <p>📧 ${merchant.email}</p>
                                            <p>📞 ${merchant.phone}</p>
                                            <p>🏪 ${merchant.storeName}</p>
                                        </div>
                                    </div>
                                    <div class="flex gap-2 ml-4">
                                        <button onclick="editMerchant(${merchant.id})" class="bg-blue-500 text-white px-3 py-2 rounded hover:bg-blue-600 text-sm">Editar</button>
                                        <button onclick="deactivateMerchant(${merchant.id})" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">Desativar</button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
                
                ${inactiveMerchants.length > 0 ? `
                <div>
                    <h4 class="text-lg font-semibold mb-4 text-red-600">❌ Lojistas Inativos (${inactiveMerchants.length})</h4>
                    <div class="space-y-4">
                        ${inactiveMerchants.map(merchant => `
                            <div class="bg-red-50 border border-red-200 p-4 rounded-lg">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <h5 class="font-bold text-lg">${merchant.name}</h5>
                                        <div class="space-y-1 text-sm text-gray-600">
                                            <p>📧 ${merchant.email}</p>
                                            <p>📞 ${merchant.phone}</p>
                                            <p>🏪 ${merchant.storeName}</p>
                                        </div>
                                    </div>
                                    <div class="flex gap-2 ml-4">
                                        <button onclick="editMerchant(${merchant.id})" class="bg-blue-500 text-white px-3 py-2 rounded hover:bg-blue-600 text-sm">Editar</button>
                                        <button onclick="activateMerchant(${merchant.id})" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Ativar</button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
            `;
        }

        function showCustomers() {
            const content = document.getElementById('adminContent');
            content.innerHTML = `
                <h3 class="text-xl font-bold mb-4">Gerenciar Clientes</h3>
                <div class="space-y-4">
                    ${customers.map(customer => `
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h4 class="font-bold text-lg">${customer.name}</h4>
                                    <p class="text-gray-600">📧 ${customer.email}</p>
                                    <p class="text-gray-600">📞 ${customer.phone || 'Não informado'}</p>
                                    <p class="text-sm text-gray-500">❤️ ${customer.favoriteStores?.length || 0} lojas favoritas</p>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function manageNews() {
            const content = document.getElementById('adminContent');
            content.innerHTML = `
                <h3 class="text-xl font-bold mb-4">📱 Gerenciar Stories e Notícias</h3>
                
                <div class="bg-gray-50 p-6 rounded-lg mb-6">
                    <h4 class="text-lg font-semibold mb-4">Criar Novo Story/Notícia</h4>
                    <form id="addNewsForm">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Título</label>
                                <input type="text" id="newNewsTitle" placeholder="Título da notícia/story" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Tipo de Mídia</label>
                                <select id="newNewsType" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" onchange="toggleMediaInput()" required>
                                    <option value="text">Texto/Emoji</option>
                                    <option value="image">Imagem</option>
                                    <option value="video">Vídeo</option>
                                </select>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-gray-700 font-medium mb-2">Conteúdo</label>
                                <textarea id="newNewsContent" placeholder="Conteúdo da notícia/story" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 h-24" required></textarea>
                            </div>
                            <div id="textMediaInput">
                                <label class="block text-gray-700 font-medium mb-2">Emoji/Ícone</label>
                                <input type="text" id="newNewsEmoji" placeholder="🎉" maxlength="4" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div id="fileMediaInput" class="hidden">
                                <label class="block text-gray-700 font-medium mb-2">Arquivo de Mídia</label>
                                <input type="file" id="newNewsFile" accept="image/*,video/*" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                <p class="text-sm text-gray-500 mt-1">Máximo 10MB - Imagens: JPG, PNG, GIF | Vídeos: MP4, WebM</p>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Duração (horas)</label>
                                <select id="newNewsDuration" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    <option value="1">1 hora</option>
                                    <option value="6">6 horas</option>
                                    <option value="12">12 horas</option>
                                    <option value="24" selected>24 horas</option>
                                    <option value="48">48 horas</option>
                                    <option value="168">1 semana</option>
                                </select>
                            </div>
                        </div>
                        <div class="mt-6">
                            <button type="submit" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors">
                                📱 Publicar Story/Notícia
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="space-y-4">
                    <h4 class="text-lg font-semibold">Stories e Notícias Existentes</h4>
                    ${news.map(item => {
                        const hoursAgo = (new Date() - new Date(item.publishedAt)) / (1000 * 60 * 60);
                        const isActive = hoursAgo < item.duration;
                        const timeLeft = Math.max(0, item.duration - hoursAgo);
                        
                        return `
                            <div class="bg-white border rounded-lg p-4 ${isActive ? 'border-green-200 bg-green-50' : 'border-gray-200'}">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <div class="flex items-center mb-2">
                                            <div class="w-12 h-12 mr-3 rounded-lg overflow-hidden bg-gray-100 flex items-center justify-center">
                                                ${item.type === 'image' ? `
                                                    <img src="${item.media}" class="w-full h-full object-cover">
                                                ` : item.type === 'video' ? `
                                                    <video class="w-full h-full object-cover" muted>
                                                        <source src="${item.media}" type="video/mp4">
                                                    </video>
                                                ` : `
                                                    <span class="text-2xl">${item.media}</span>
                                                `}
                                            </div>
                                            <div class="flex-1">
                                                <h5 class="font-bold text-lg">${item.title}</h5>
                                                <div class="text-sm text-gray-500">
                                                    📅 ${new Date(item.publishedAt).toLocaleDateString('pt-BR')} ${new Date(item.publishedAt).toLocaleTimeString('pt-BR')}
                                                    | 📱 ${item.type.toUpperCase()}
                                                    | 👍 ${item.likes || 0} | 👁️ ${item.views || 0}
                                                </div>
                                                <div class="text-sm ${isActive ? 'text-green-600' : 'text-red-600'} font-medium">
                                                    ${isActive ? `🟢 Ativo - ${Math.floor(timeLeft)}h restantes` : '🔴 Expirado'}
                                                </div>
                                            </div>
                                        </div>
                                        <p class="text-gray-600 ml-15">${item.content}</p>
                                    </div>
                                    <div class="flex gap-2 ml-4">
                                        <button onclick="editNews(${item.id})" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">Editar</button>
                                        <button onclick="deleteNews(${item.id})" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600">Excluir</button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
            
            // Add form event listener
            setTimeout(() => {
                document.getElementById('addNewsForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    addNews();
                });
            }, 100);
        }

        function toggleMediaInput() {
            const type = document.getElementById('newNewsType').value;
            const textInput = document.getElementById('textMediaInput');
            const fileInput = document.getElementById('fileMediaInput');
            
            if (type === 'text') {
                textInput.classList.remove('hidden');
                fileInput.classList.add('hidden');
            } else {
                textInput.classList.add('hidden');
                fileInput.classList.remove('hidden');
            }
        }

        function addNews() {
            const title = document.getElementById('newNewsTitle').value;
            const content = document.getElementById('newNewsContent').value;
            const type = document.getElementById('newNewsType').value;
            const duration = parseInt(document.getElementById('newNewsDuration').value);
            
            if (!title || !content) {
                alert('Por favor, preencha título e conteúdo.');
                return;
            }
            
            const processNewsItem = (mediaContent) => {
                const newNewsItem = {
                    id: Date.now(),
                    title,
                    content,
                    media: mediaContent,
                    type: type,
                    date: new Date().toISOString(),
                    publishedAt: new Date(),
                    duration: duration,
                    likes: 0,
                    dislikes: 0,
                    views: 0,
                    viewed: false,
                    authorType: 'admin'
                };
                
                news.unshift(newNewsItem);
                renderNews();
                manageNews();
                alert(`${type === 'text' ? 'Story' : type === 'image' ? 'Story com imagem' : 'Story com vídeo'} publicado com sucesso!`);
            };
            
            if (type === 'text') {
                const emoji = document.getElementById('newNewsEmoji').value || '📰';
                processNewsItem(emoji);
            } else {
                const file = document.getElementById('newNewsFile').files[0];
                if (!file) {
                    alert('Por favor, selecione um arquivo de mídia.');
                    return;
                }
                
                // Validate file size (max 10MB)
                if (file.size > 10 * 1024 * 1024) {
                    alert('Arquivo muito grande! Máximo 10MB.');
                    return;
                }
                
                // Validate file type
                const validImageTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
                const validVideoTypes = ['video/mp4', 'video/webm', 'video/ogg'];
                
                if (type === 'image' && !validImageTypes.includes(file.type)) {
                    alert('Tipo de imagem inválido! Use JPG, PNG ou GIF.');
                    return;
                }
                
                if (type === 'video' && !validVideoTypes.includes(file.type)) {
                    alert('Tipo de vídeo inválido! Use MP4, WebM ou OGG.');
                    return;
                }
                
                // Read file and process
                const reader = new FileReader();
                reader.onload = function(e) {
                    processNewsItem(e.target.result);
                };
                reader.readAsDataURL(file);
            }
        }

        function editNews(id) {
            const newsItem = news.find(n => n.id === id);
            if (!newsItem) return;
            
            // Create edit modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 max-h-screen overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold">✏️ Editar Story/Notícia</h2>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">×</button>
                    </div>
                    
                    <form id="editNewsForm">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Título</label>
                                <input type="text" id="editNewsTitle" value="${newsItem.title}" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Conteúdo</label>
                                <textarea id="editNewsContent" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 h-24" required>${newsItem.content}</textarea>
                            </div>
                            ${newsItem.type === 'text' ? `
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">Emoji/Ícone</label>
                                    <input type="text" id="editNewsEmoji" value="${newsItem.media}" maxlength="4" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                </div>
                            ` : `
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">Mídia Atual</label>
                                    <div class="w-20 h-20 border rounded-lg overflow-hidden bg-gray-100 flex items-center justify-center mb-2">
                                        ${newsItem.type === 'image' ? 
                                            `<img src="${newsItem.media}" class="w-full h-full object-cover">` :
                                            `<video class="w-full h-full object-cover" muted><source src="${newsItem.media}"></video>`
                                        }
                                    </div>
                                    <input type="file" id="editNewsFile" accept="${newsItem.type === 'image' ? 'image/*' : 'video/*'}" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    <p class="text-sm text-gray-500 mt-1">Deixe vazio para manter a mídia atual</p>
                                </div>
                            `}
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Duração (horas)</label>
                                <select id="editNewsDuration" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    <option value="1" ${newsItem.duration === 1 ? 'selected' : ''}>1 hora</option>
                                    <option value="6" ${newsItem.duration === 6 ? 'selected' : ''}>6 horas</option>
                                    <option value="12" ${newsItem.duration === 12 ? 'selected' : ''}>12 horas</option>
                                    <option value="24" ${newsItem.duration === 24 ? 'selected' : ''}>24 horas</option>
                                    <option value="48" ${newsItem.duration === 48 ? 'selected' : ''}>48 horas</option>
                                    <option value="168" ${newsItem.duration === 168 ? 'selected' : ''}>1 semana</option>
                                </select>
                            </div>
                        </div>
                        <div class="mt-6 flex gap-3">
                            <button type="submit" class="flex-1 bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors">
                                💾 Salvar Alterações
                            </button>
                            <button type="button" onclick="this.closest('.fixed').remove()" class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                Cancelar
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add form event listener
            document.getElementById('editNewsForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const title = document.getElementById('editNewsTitle').value;
                const content = document.getElementById('editNewsContent').value;
                const duration = parseInt(document.getElementById('editNewsDuration').value);
                
                if (!title || !content) {
                    alert('Por favor, preencha título e conteúdo.');
                    return;
                }
                
                const updateNewsItem = (mediaContent = null) => {
                    newsItem.title = title;
                    newsItem.content = content;
                    newsItem.duration = duration;
                    
                    if (mediaContent) {
                        newsItem.media = mediaContent;
                    } else if (newsItem.type === 'text') {
                        newsItem.media = document.getElementById('editNewsEmoji').value || newsItem.media;
                    }
                    
                    renderNews();
                    manageNews();
                    modal.remove();
                    alert('Story/Notícia atualizada com sucesso!');
                };
                
                // Handle file upload if present
                const fileInput = document.getElementById('editNewsFile');
                if (fileInput && fileInput.files[0]) {
                    const file = fileInput.files[0];
                    
                    // Validate file size (max 10MB)
                    if (file.size > 10 * 1024 * 1024) {
                        alert('Arquivo muito grande! Máximo 10MB.');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        updateNewsItem(e.target.result);
                    };
                    reader.readAsDataURL(file);
                } else {
                    updateNewsItem();
                }
            });
        }

        function deleteNews(id) {
            if (confirm('Tem certeza que deseja excluir esta notícia?')) {
                const index = news.findIndex(n => n.id === id);
                if (index > -1) {
                    news.splice(index, 1);
                    renderNews();
                    manageNews();
                    alert('Notícia excluída com sucesso!');
                }
            }
        }

        function showAppSettings() {
            const content = document.getElementById('adminContent');
            content.innerHTML = `
                <h3 class="text-xl font-bold mb-4">⚙️ Configurações do Aplicativo</h3>
                
                <!-- Logo Settings -->
                <div class="bg-white rounded-lg p-6 mb-6 shadow-lg">
                    <h4 class="text-lg font-semibold mb-4">🎨 Logo do Aplicativo</h4>
                    <div class="space-y-6">
                        <!-- Current Logo Display -->
                        <div class="text-center">
                            <div id="currentLogoDisplay" class="w-24 h-24 mx-auto bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center text-white text-2xl font-bold mb-3 shadow-lg">
                                ${appSettings.logo.type === 'image' ? 
                                    `<img src="${appSettings.logo.content}" class="w-full h-full object-cover rounded-full">` :
                                    appSettings.logo.content
                                }
                            </div>
                            <p class="text-sm text-gray-600">Logo Atual</p>
                        </div>
                        
                        <!-- Logo Upload Options -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Upload Image Logo -->
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-purple-400 transition-colors">
                                <div class="mb-4">
                                    <div class="w-16 h-16 mx-auto bg-purple-100 rounded-full flex items-center justify-center mb-3">
                                        <span class="text-2xl">🖼️</span>
                                    </div>
                                    <h5 class="font-medium text-gray-800 mb-2">Upload de Imagem</h5>
                                    <p class="text-sm text-gray-600 mb-4">Envie uma imagem para usar como logo</p>
                                </div>
                                <input type="file" id="logoImageFile" accept="image/*" class="hidden" onchange="previewLogoImage(this)">
                                <button type="button" onclick="document.getElementById('logoImageFile').click()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors">
                                    Escolher Imagem
                                </button>
                                <p class="text-xs text-gray-500 mt-2">PNG, JPG, GIF - Máximo 5MB</p>
                            </div>
                            
                            <!-- Text Logo -->
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors">
                                <div class="mb-4">
                                    <div class="w-16 h-16 mx-auto bg-blue-100 rounded-full flex items-center justify-center mb-3">
                                        <span class="text-2xl">✏️</span>
                                    </div>
                                    <h5 class="font-medium text-gray-800 mb-2">Logo de Texto</h5>
                                    <p class="text-sm text-gray-600 mb-4">Use texto personalizado como logo</p>
                                </div>
                                <input type="text" id="logoTextInput" value="${appSettings.logo.type === 'text' ? appSettings.logo.content : 'MB'}" placeholder="Digite o texto do logo" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-3" maxlength="4" onchange="previewLogoText(this)">
                                <button type="button" onclick="useTextLogo()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                                    Usar Texto
                                </button>
                            </div>
                        </div>
                        
                        <!-- Preview Section -->
                        <div id="logoPreviewSection" class="hidden">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <div class="flex items-center justify-between mb-3">
                                    <h5 class="font-medium text-gray-800">Preview do Novo Logo</h5>
                                    <button onclick="cancelLogoPreview()" class="text-gray-500 hover:text-gray-700">
                                        <span class="text-lg">×</span>
                                    </button>
                                </div>
                                <div class="flex items-center justify-center mb-4">
                                    <div id="logoPreview" class="w-20 h-20 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center text-white text-xl font-bold shadow-lg">
                                        MB
                                    </div>
                                </div>
                                <div class="flex gap-3 justify-center">
                                    <button onclick="saveLogo()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition-colors">
                                        ✅ Salvar Logo
                                    </button>
                                    <button onclick="cancelLogoPreview()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg transition-colors">
                                        ❌ Cancelar
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Current Logo Actions -->
                        ${appSettings.logo.type === 'image' ? `
                            <div class="text-center">
                                <button onclick="removeCurrentLogo()" class="text-red-600 hover:text-red-700 text-sm">
                                    🗑️ Remover Logo Atual
                                </button>
                            </div>
                        ` : ''}
                    </div>
                </div>

                <!-- App Info Settings -->
                <div class="bg-white rounded-lg p-6 mb-6 shadow-lg">
                    <h4 class="text-lg font-semibold mb-4">Informações do Aplicativo</h4>
                    <form id="appInfoForm">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Nome do Aplicativo</label>
                                <input type="text" id="appName" value="${appSettings.name}" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Slogan</label>
                                <input type="text" id="appSlogan" value="${appSettings.slogan}" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-gray-700 font-medium mb-2">Descrição</label>
                                <textarea id="appDescription" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 h-20">${appSettings.description}</textarea>
                            </div>
                        </div>
                        <button type="submit" class="mt-4 bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg transition-colors">
                            Salvar Informações
                        </button>
                    </form>
                </div>

                <!-- Contact Settings -->
                <div class="bg-white rounded-lg p-6 mb-6 shadow-lg">
                    <h4 class="text-lg font-semibold mb-4">Informações de Contato</h4>
                    <form id="contactForm">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Telefone de Suporte</label>
                                <input type="tel" id="supportPhone" value="${appSettings.contact.phone}" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">WhatsApp</label>
                                <input type="tel" id="supportWhatsapp" value="${appSettings.contact.whatsapp}" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Email de Suporte</label>
                                <input type="email" id="supportEmail" value="${appSettings.contact.email}" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Horário de Atendimento</label>
                                <input type="text" id="supportHours" value="${appSettings.contact.hours}" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                            </div>
                        </div>
                        <button type="submit" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors">
                            Salvar Contatos
                        </button>
                    </form>
                </div>

                <!-- Categories Management -->
                <div class="bg-white rounded-lg p-6 mb-6 shadow-lg">
                    <h4 class="text-lg font-semibold mb-4">Gerenciar Categorias</h4>
                    <div class="mb-4">
                        <div class="bg-gray-50 p-4 rounded-lg mb-4">
                            <h5 class="font-medium mb-3">Adicionar Nova Categoria</h5>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">Nome da Categoria</label>
                                    <input type="text" id="newCategoryName" placeholder="Ex: Eletrônicos" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">Tipo de Ícone</label>
                                    <select id="categoryIconType" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" onchange="toggleCategoryIconInput()">
                                        <option value="emoji">Emoji</option>
                                        <option value="image">Imagem</option>
                                    </select>
                                </div>
                                <div id="categoryEmojiInput">
                                    <label class="block text-gray-700 font-medium mb-2">Emoji</label>
                                    <input type="text" id="newCategoryEmoji" placeholder="🏪" maxlength="4" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                </div>
                                <div id="categoryImageInput" class="hidden">
                                    <label class="block text-gray-700 font-medium mb-2">Imagem</label>
                                    <input type="file" id="newCategoryImage" accept="image/*" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    <p class="text-sm text-gray-500 mt-1">Máximo 1MB - PNG, JPG</p>
                                </div>
                            </div>
                            <button onclick="addCategory()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition-colors">
                                Adicionar Categoria
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3" id="categoriesList">
                        ${availableCategories.map(category => `
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div class="flex items-center gap-2">
                                    ${category.type === 'image' ? 
                                        `<img src="${category.emoji}" class="w-6 h-6 rounded-full object-cover">` :
                                        `<span class="text-lg">${category.emoji}</span>`
                                    }
                                    <span class="font-medium">${category.name}</span>
                                    <span class="text-xs px-2 py-1 rounded ${category.type === 'image' ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800'}">${category.type === 'image' ? 'Imagem' : 'Emoji'}</span>
                                </div>
                                <div class="flex gap-2">
                                    ${category.id === 'todos' ? 
                                        '<span class="text-xs text-gray-500 px-2 py-1 bg-gray-200 rounded">Padrão</span>' : 
                                        `<button onclick="editCategory('${category.id}')" class="text-blue-500 hover:text-blue-700 text-sm px-2 py-1 rounded hover:bg-blue-50">✏️</button>
                                         <button onclick="removeCategory('${category.id}')" class="text-red-500 hover:text-red-700 text-sm px-2 py-1 rounded hover:bg-red-50">🗑️</button>`
                                    }
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <!-- Social Media Settings -->
                <div class="bg-white rounded-lg p-6 mb-6 shadow-lg">
                    <h4 class="text-lg font-semibold mb-4">📱 Redes Sociais</h4>
                    <form id="socialForm">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Instagram</label>
                                <input type="text" id="instagramHandle" value="${appSettings.social.instagram}" placeholder="@meubairro_oficial" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                <p class="text-sm text-gray-500 mt-1">Digite o @ do Instagram (ex: @meubairro_oficial)</p>
                            </div>
                        </div>
                        <button type="submit" class="mt-4 bg-pink-600 hover:bg-pink-700 text-white px-6 py-2 rounded-lg transition-colors">
                            Salvar Redes Sociais
                        </button>
                    </form>
                </div>

                <!-- System Stats -->
                <div class="bg-white rounded-lg p-6 shadow-lg">
                    <h4 class="text-lg font-semibold mb-4">Estatísticas do Sistema</h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="text-center p-4 bg-blue-50 rounded-lg">
                            <div class="text-2xl font-bold text-blue-600">${stores.length}</div>
                            <div class="text-sm text-gray-600">Total de Lojas</div>
                        </div>
                        <div class="text-center p-4 bg-green-50 rounded-lg">
                            <div class="text-2xl font-bold text-green-600">${merchants.length}</div>
                            <div class="text-sm text-gray-600">Lojistas</div>
                        </div>
                        <div class="text-center p-4 bg-purple-50 rounded-lg">
                            <div class="text-2xl font-bold text-purple-600">${customers.length}</div>
                            <div class="text-sm text-gray-600">Clientes</div>
                        </div>
                        <div class="text-center p-4 bg-yellow-50 rounded-lg">
                            <div class="text-2xl font-bold text-yellow-600">${news.length}</div>
                            <div class="text-sm text-gray-600">Notícias</div>
                        </div>
                    </div>
                </div>
            `;

            // Add event listeners
            setTimeout(() => {
                document.getElementById('appInfoForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    appSettings.name = document.getElementById('appName').value;
                    appSettings.slogan = document.getElementById('appSlogan').value;
                    appSettings.description = document.getElementById('appDescription').value;
                    updateAppDisplay();
                    alert('Informações do aplicativo salvas com sucesso!');
                });

                document.getElementById('contactForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    appSettings.contact.phone = document.getElementById('supportPhone').value;
                    appSettings.contact.whatsapp = document.getElementById('supportWhatsapp').value;
                    appSettings.contact.email = document.getElementById('supportEmail').value;
                    appSettings.contact.hours = document.getElementById('supportHours').value;
                    alert('Informações de contato salvas com sucesso!');
                });

                document.getElementById('socialForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    appSettings.social.instagram = document.getElementById('instagramHandle').value;
                    alert('Informações de redes sociais salvas com sucesso!');
                });

            }, 100);
        }

        let pendingLogoData = null;

        function previewLogoImage(input) {
            const file = input.files[0];
            if (!file) return;
            
            // Validate file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('Arquivo muito grande! Máximo 5MB.');
                input.value = '';
                return;
            }
            
            // Validate file type
            if (!file.type.startsWith('image/')) {
                alert('Por favor, selecione um arquivo de imagem válido (PNG, JPG, GIF).');
                input.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                pendingLogoData = {
                    type: 'image',
                    content: e.target.result
                };
                
                // Show preview
                const preview = document.getElementById('logoPreview');
                preview.innerHTML = `<img src="${e.target.result}" class="w-full h-full object-cover rounded-full">`;
                
                // Show preview section
                document.getElementById('logoPreviewSection').classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        }
        
        function previewLogoText(input) {
            const text = input.value || 'MB';
            pendingLogoData = {
                type: 'text',
                content: text
            };
            
            // Show preview
            const preview = document.getElementById('logoPreview');
            preview.innerHTML = text;
            preview.className = "w-20 h-20 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center text-white text-xl font-bold shadow-lg";
            
            // Show preview section
            document.getElementById('logoPreviewSection').classList.remove('hidden');
        }
        
        function useTextLogo() {
            const textInput = document.getElementById('logoTextInput');
            const text = textInput.value.trim();
            
            if (!text) {
                alert('Por favor, digite o texto do logo.');
                return;
            }
            
            if (text.length > 4) {
                alert('O texto do logo deve ter no máximo 4 caracteres.');
                return;
            }
            
            previewLogoText(textInput);
        }
        
        function cancelLogoPreview() {
            pendingLogoData = null;
            document.getElementById('logoPreviewSection').classList.add('hidden');
            
            // Clear file inputs
            document.getElementById('logoImageFile').value = '';
        }
        
        function saveLogo() {
            if (!pendingLogoData) {
                alert('Nenhum logo selecionado para salvar.');
                return;
            }
            
            // Save the logo
            appSettings.logo = { ...pendingLogoData };
            
            // Update displays
            updateAppDisplay();
            updateCurrentLogoDisplay();
            
            // Hide preview and clear pending data
            cancelLogoPreview();
            
            alert('Logo salvo com sucesso!');
            
            // Refresh the settings page to show the new remove button if needed
            showAppSettings();
        }
        
        function updateCurrentLogoDisplay() {
            const currentDisplay = document.getElementById('currentLogoDisplay');
            if (!currentDisplay) return;
            
            if (appSettings.logo.type === 'image') {
                currentDisplay.innerHTML = `<img src="${appSettings.logo.content}" class="w-full h-full object-cover rounded-full">`;
            } else {
                currentDisplay.innerHTML = appSettings.logo.content;
                currentDisplay.className = "w-24 h-24 mx-auto bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center text-white text-2xl font-bold mb-3 shadow-lg";
            }
        }
        
        function removeCurrentLogo() {
            if (confirm('Tem certeza que deseja remover o logo atual? O logo voltará para o padrão de texto.')) {
                appSettings.logo = {
                    type: 'text',
                    content: 'MB'
                };
                
                updateAppDisplay();
                alert('Logo removido com sucesso!');
                showAppSettings();
            }
        }


        function toggleCategoryIconInput() {
            const type = document.getElementById('categoryIconType').value;
            const emojiInput = document.getElementById('categoryEmojiInput');
            const imageInput = document.getElementById('categoryImageInput');
            
            if (type === 'emoji') {
                emojiInput.classList.remove('hidden');
                imageInput.classList.add('hidden');
            } else {
                emojiInput.classList.add('hidden');
                imageInput.classList.remove('hidden');
            }
        }

        function addCategory() {
            const name = document.getElementById('newCategoryName').value;
            const type = document.getElementById('categoryIconType').value;
            
            if (!name) {
                alert('Por favor, digite o nome da categoria.');
                return;
            }
            
            const id = name.toLowerCase().replace(/\s+/g, '').replace(/[^a-z0-9]/g, '');
            
            if (availableCategories.find(c => c.id === id)) {
                alert('Esta categoria já existe.');
                return;
            }
            
            const processCategory = (iconContent) => {
                const newCategory = {
                    id: id,
                    name: name,
                    emoji: iconContent,
                    type: type
                };
                
                availableCategories.push(newCategory);
                renderCategories();
                showAppSettings();
                alert(`Categoria "${name}" adicionada com sucesso!`);
                
                // Clear form
                document.getElementById('newCategoryName').value = '';
                document.getElementById('newCategoryEmoji').value = '';
                document.getElementById('newCategoryImage').value = '';
            };
            
            if (type === 'emoji') {
                const emoji = document.getElementById('newCategoryEmoji').value;
                if (!emoji) {
                    alert('Por favor, digite um emoji para a categoria.');
                    return;
                }
                processCategory(emoji);
            } else {
                const imageFile = document.getElementById('newCategoryImage').files[0];
                if (!imageFile) {
                    alert('Por favor, selecione uma imagem para a categoria.');
                    return;
                }
                
                // Validate file size (max 1MB)
                if (imageFile.size > 1024 * 1024) {
                    alert('Imagem muito grande! Máximo 1MB.');
                    return;
                }
                
                // Validate file type
                if (!imageFile.type.startsWith('image/')) {
                    alert('Por favor, selecione um arquivo de imagem válido.');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    processCategory(e.target.result);
                };
                reader.readAsDataURL(imageFile);
            }
        }

        function editCategory(categoryId) {
            const category = availableCategories.find(c => c.id === categoryId);
            if (!category) return;
            
            const newName = prompt('Nome da categoria:', category.name);
            if (newName === null || newName === '') return;
            
            if (category.type === 'emoji') {
                const newEmoji = prompt('Emoji da categoria:', category.emoji);
                if (newEmoji === null) return;
                
                category.name = newName;
                category.emoji = newEmoji || category.emoji;
            } else {
                const changeImage = confirm(`Categoria: ${newName}\n\nDeseja alterar a imagem? (Cancelar para manter a atual)`);
                category.name = newName;
                
                if (changeImage) {
                    // Create file input for new image
                    const fileInput = document.createElement('input');
                    fileInput.type = 'file';
                    fileInput.accept = 'image/*';
                    fileInput.onchange = function(e) {
                        const file = e.target.files[0];
                        if (file) {
                            if (file.size > 1024 * 1024) {
                                alert('Imagem muito grande! Máximo 1MB.');
                                return;
                            }
                            
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                category.emoji = e.target.result;
                                renderCategories();
                                showAppSettings();
                                alert('Categoria atualizada com sucesso!');
                            };
                            reader.readAsDataURL(file);
                        }
                    };
                    fileInput.click();
                    return; // Don't update immediately, wait for image
                }
            }
            
            renderCategories();
            showAppSettings();
            alert('Categoria atualizada com sucesso!');
        }

        function removeCategory(categoryId) {
            if (categoryId === 'todos') {
                alert('Não é possível remover a categoria "Todos".');
                return;
            }
            
            const category = availableCategories.find(c => c.id === categoryId);
            if (confirm(`Tem certeza que deseja remover a categoria "${category.name}"?`)) {
                availableCategories = availableCategories.filter(c => c.id !== categoryId);
                renderCategories();
                showAppSettings();
                alert(`Categoria "${category.name}" removida com sucesso!`);
            }
        }
        
        function openInstagram() {
            const handle = appSettings.social.instagram.replace('@', '');
            window.open(`https://instagram.com/${handle}`, '_blank');
        }

        // Store approval functions
        function approveStore(storeId) {
            const store = stores.find(s => s.id === storeId);
            const merchant = merchants.find(m => m.id === store.merchantId);
            
            if (store && merchant) {
                store.status = 'approved';
                merchant.status = 'approved';
                alert(`Loja "${store.name}" aprovada com sucesso!`);
                showAllStores();
                updateAdminStats();
                renderStores();
            }
        }

        function rejectStore(storeId) {
            const store = stores.find(s => s.id === storeId);
            const merchant = merchants.find(m => m.id === store.merchantId);
            
            if (store && merchant) {
                store.status = 'rejected';
                merchant.status = 'rejected';
                alert(`Loja "${store.name}" rejeitada.`);
                showAllStores();
                updateAdminStats();
                renderStores();
            }
        }

        function deactivateStore(storeId) {
            const store = stores.find(s => s.id === storeId);
            if (store) {
                store.status = 'inactive';
                alert(`Loja "${store.name}" desativada.`);
                showAllStores();
                renderStores();
            }
        }

        function activateStore(storeId) {
            const store = stores.find(s => s.id === storeId);
            if (store) {
                store.status = 'approved';
                alert(`Loja "${store.name}" ativada.`);
                showAllStores();
                renderStores();
            }
        }

        // Merchant approval functions
        function approveMerchant(merchantId) {
            const merchant = merchants.find(m => m.id === merchantId);
            const store = stores.find(s => s.merchantId === merchantId);
            
            if (merchant && store) {
                merchant.status = 'approved';
                store.status = 'approved';
                alert(`Lojista "${merchant.name}" aprovado com sucesso!`);
                showMerchants();
                updateAdminStats();
                renderStores();
            }
        }

        function rejectMerchant(merchantId) {
            const merchant = merchants.find(m => m.id === merchantId);
            const store = stores.find(s => s.merchantId === merchantId);
            
            if (merchant && store) {
                merchant.status = 'rejected';
                store.status = 'rejected';
                alert(`Lojista "${merchant.name}" rejeitado.`);
                showMerchants();
                updateAdminStats();
                renderStores();
            }
        }

        function deactivateMerchant(merchantId) {
            const merchant = merchants.find(m => m.id === merchantId);
            const store = stores.find(s => s.merchantId === merchantId);
            
            if (merchant && store) {
                merchant.status = 'inactive';
                store.status = 'inactive';
                alert(`Lojista "${merchant.name}" desativado.`);
                showMerchants();
                renderStores();
            }
        }

        function activateMerchant(merchantId) {
            const merchant = merchants.find(m => m.id === merchantId);
            const store = stores.find(s => s.merchantId === merchantId);
            
            if (merchant && store) {
                merchant.status = 'approved';
                store.status = 'approved';
                alert(`Lojista "${merchant.name}" ativado.`);
                showMerchants();
                renderStores();
            }
        }

        // Edit merchant functions
        function editMerchant(merchantId) {
            const merchant = merchants.find(m => m.id === merchantId);
            if (!merchant) return;
            
            // Fill the form with current data
            document.getElementById('editMerchantId').value = merchant.id;
            document.getElementById('editMerchantName').value = merchant.name;
            document.getElementById('editMerchantEmail').value = merchant.email;
            document.getElementById('editMerchantPhone').value = merchant.phone;
            document.getElementById('editMerchantDocument').value = merchant.document;
            document.getElementById('editMerchantStoreName').value = merchant.storeName;
            document.getElementById('editMerchantAddress').value = merchant.address;
            document.getElementById('editMerchantStatus').value = merchant.status;
            document.getElementById('editMerchantPassword').value = '';
            document.getElementById('editMerchantConfirmPassword').value = '';
            
            // Show modal
            document.getElementById('editMerchantModal').classList.remove('hidden');
            document.getElementById('editMerchantModal').classList.add('flex');
        }

        function closeEditMerchantModal() {
            document.getElementById('editMerchantModal').classList.add('hidden');
            document.getElementById('editMerchantModal').classList.remove('flex');
        }

        function saveEditMerchant(e) {
            e.preventDefault();
            
            const merchantId = parseInt(document.getElementById('editMerchantId').value);
            const merchant = merchants.find(m => m.id === merchantId);
            const store = stores.find(s => s.merchantId === merchantId);
            
            if (!merchant) return;
            
            // Get form data
            const name = document.getElementById('editMerchantName').value;
            const email = document.getElementById('editMerchantEmail').value;
            const phone = document.getElementById('editMerchantPhone').value;
            const document = document.getElementById('editMerchantDocument').value;
            const storeName = document.getElementById('editMerchantStoreName').value;
            const address = document.getElementById('editMerchantAddress').value;
            const status = document.getElementById('editMerchantStatus').value;
            const password = document.getElementById('editMerchantPassword').value;
            const confirmPassword = document.getElementById('editMerchantConfirmPassword').value;
            
            // Validate passwords if provided
            if (password && password !== confirmPassword) {
                alert('As senhas não coincidem!');
                return;
            }
            
            // Check if email is already used by another merchant
            const existingMerchant = merchants.find(m => m.email === email && m.id !== merchantId);
            if (existingMerchant) {
                alert('Este email já está sendo usado por outro lojista!');
                return;
            }
            
            // Update merchant data
            merchant.name = name;
            merchant.email = email;
            merchant.phone = phone;
            merchant.document = document;
            merchant.storeName = storeName;
            merchant.address = address;
            merchant.status = status;
            
            // Update password if provided
            if (password) {
                merchant.password = password;
            }
            
            // Update store data if exists
            if (store) {
                store.name = storeName;
                store.address = address;
                store.phone = phone;
                store.status = status;
            }
            
            alert(`Dados do lojista "${name}" atualizados com sucesso!`);
            closeEditMerchantModal();
            showMerchants();
            updateAdminStats();
            renderStores();
        }

        // Merchant functions
        function showStoreSettings() {
            const store = stores.find(s => s.merchantId === currentUser.id);
            if (!store.paymentMethods) {
                store.paymentMethods = {
                    cards: [],
                    others: [],
                    agreements: []
                };
            }
            
            const content = document.getElementById('merchantContent');
            
            content.innerHTML = `
                <h3 class="text-xl font-bold mb-4">🏪 Configurações da Loja</h3>
                
                <div class="space-y-8">
                    <!-- Informações Básicas -->
                    <div class="bg-white rounded-lg p-6 shadow-lg">
                        <h4 class="text-lg font-semibold mb-4">📋 Informações Básicas</h4>
                        <form id="merchantStoreForm">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Logo da Loja -->
                                <div class="md:col-span-2">
                                    <label class="block text-gray-700 font-medium mb-2">Logo da Loja</label>
                                    <div class="flex items-center gap-4">
                                        <div class="w-20 h-20 border rounded-lg overflow-hidden bg-gray-100 flex items-center justify-center">
                                            ${store?.logo ? 
                                                `<img src="${store.logo}" class="w-full h-full object-cover">` :
                                                `<span class="text-2xl">${store?.emoji || '🏪'}</span>`
                                            }
                                        </div>
                                        <div class="flex-1">
                                            <input type="file" id="merchantStoreLogo" accept="image/*" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <p class="text-sm text-gray-500 mt-1">Máximo 2MB - JPG, PNG ou GIF</p>
                                            ${store?.logo ? '<button type="button" onclick="removeStoreLogo()" class="text-red-500 text-sm mt-1">Remover logo atual</button>' : ''}
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">Nome da Loja</label>
                                    <input type="text" id="merchantStoreNameInput" value="${store?.name || ''}" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">Categoria Principal</label>
                                    <select id="merchantStoreCategory" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        ${availableCategories.filter(cat => cat.id !== 'todos').map(cat => 
                                            `<option value="${cat.id}" ${store?.category === cat.id ? 'selected' : ''}>${cat.emoji} ${cat.name}</option>`
                                        ).join('')}
                                    </select>
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-gray-700 font-medium mb-2">Especialidades (separadas por vírgula)</label>
                                    <input type="text" id="merchantStoreCategories" value="${store?.categories?.join(', ') || ''}" placeholder="Ex: Pães, Doces, Salgados, Bebidas" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">Endereço</label>
                                    <input type="text" id="merchantStoreAddress" value="${store?.address || ''}" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">Telefone</label>
                                    <input type="tel" id="merchantStorePhone" value="${store?.phone || ''}" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">Bairro</label>
                                    <input type="text" id="merchantStoreNeighborhood" value="${store?.neighborhood || ''}" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">Zona</label>
                                    <input type="text" id="merchantStoreZone" value="${store?.zone || ''}" placeholder="Ex: Centro, Zona Sul, Zona Norte" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">Estado</label>
                                    <input type="text" id="merchantStoreState" value="${store?.state || ''}" placeholder="Ex: SP, RJ, MG" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">Emoji da Loja</label>
                                    <input type="text" id="merchantStoreEmoji" value="${store?.emoji || '🏪'}" maxlength="2" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-gray-700 font-medium mb-2">Descrição</label>
                                    <textarea id="merchantStoreDescription" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 h-24">${store?.description || ''}</textarea>
                                </div>
                            </div>
                            <div class="mt-6">
                                <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg transition-colors">
                                    💾 Salvar Informações Básicas
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Formas de Pagamento -->
                    <div class="bg-white rounded-lg p-6 shadow-lg">
                        <h4 class="text-lg font-semibold mb-4">💳 Formas de Pagamento Aceitas</h4>
                        
                        <!-- Cartões de Crédito/Débito -->
                        <div class="mb-6">
                            <h5 class="font-medium text-gray-800 mb-3">💳 Cartões de Crédito e Débito</h5>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                ${getAvailableCards().map(card => `
                                    <div class="payment-method-item border rounded-lg p-3 cursor-pointer hover:bg-gray-50 transition-colors ${store.paymentMethods.cards.includes(card.id) ? 'border-blue-500 bg-blue-50' : 'border-gray-200'}" onclick="togglePaymentMethod('cards', '${card.id}')">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center">
                                                <img src="${card.logo}" alt="${card.name}" class="w-8 h-5 object-contain mr-2">
                                                <span class="text-sm font-medium">${card.name}</span>
                                            </div>
                                            <div class="w-5 h-5 rounded border-2 flex items-center justify-center ${store.paymentMethods.cards.includes(card.id) ? 'border-blue-500 bg-blue-500' : 'border-gray-300'}">
                                                ${store.paymentMethods.cards.includes(card.id) ? '<span class="text-white text-xs">✓</span>' : ''}
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <!-- Outras Formas de Pagamento -->
                        <div class="mb-6">
                            <h5 class="font-medium text-gray-800 mb-3">💰 Outras Formas de Pagamento</h5>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                                ${getOtherPaymentMethods().map(method => `
                                    <div class="payment-method-item border rounded-lg p-3 cursor-pointer hover:bg-gray-50 transition-colors ${store.paymentMethods.others.includes(method.id) ? 'border-green-500 bg-green-50' : 'border-gray-200'}" onclick="togglePaymentMethod('others', '${method.id}')">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center">
                                                <span class="text-2xl mr-2">${method.icon}</span>
                                                <span class="text-sm font-medium">${method.name}</span>
                                            </div>
                                            <div class="w-5 h-5 rounded border-2 flex items-center justify-center ${store.paymentMethods.others.includes(method.id) ? 'border-green-500 bg-green-500' : 'border-gray-300'}">
                                                ${store.paymentMethods.others.includes(method.id) ? '<span class="text-white text-xs">✓</span>' : ''}
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <!-- Convênios -->
                        <div class="mb-6">
                            <h5 class="font-medium text-gray-800 mb-3">🏢 Convênios Aceitos</h5>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                ${getAvailableAgreements().map(agreement => `
                                    <div class="payment-method-item border rounded-lg p-3 cursor-pointer hover:bg-gray-50 transition-colors ${store.paymentMethods.agreements.includes(agreement.id) ? 'border-purple-500 bg-purple-50' : 'border-gray-200'}" onclick="togglePaymentMethod('agreements', '${agreement.id}')">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center">
                                                <span class="text-2xl mr-2">${agreement.icon}</span>
                                                <div>
                                                    <span class="text-sm font-medium block">${agreement.name}</span>
                                                    <span class="text-xs text-gray-500">${agreement.description}</span>
                                                </div>
                                            </div>
                                            <div class="w-5 h-5 rounded border-2 flex items-center justify-center ${store.paymentMethods.agreements.includes(agreement.id) ? 'border-purple-500 bg-purple-500' : 'border-gray-300'}">
                                                ${store.paymentMethods.agreements.includes(agreement.id) ? '<span class="text-white text-xs">✓</span>' : ''}
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <!-- Adicionar Convênio Personalizado -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h5 class="font-medium text-gray-800 mb-3">➕ Adicionar Convênio Personalizado</h5>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                <input type="text" id="customAgreementName" placeholder="Nome do convênio" class="px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                <input type="text" id="customAgreementDescription" placeholder="Descrição (opcional)" class="px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                <button onclick="addCustomAgreement()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                                    ➕ Adicionar
                                </button>
                            </div>
                        </div>

                        <!-- Convênios Personalizados -->
                        <div id="customAgreementsList" class="mt-4">
                            ${store.paymentMethods.customAgreements ? `
                                <h5 class="font-medium text-gray-800 mb-3">📝 Seus Convênios Personalizados</h5>
                                <div class="space-y-2">
                                    ${store.paymentMethods.customAgreements.map((agreement, index) => `
                                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                            <div class="flex items-center">
                                                <span class="text-2xl mr-2">🏢</span>
                                                <div>
                                                    <span class="font-medium">${agreement.name}</span>
                                                    ${agreement.description ? `<span class="text-sm text-gray-500 block">${agreement.description}</span>` : ''}
                                                </div>
                                            </div>
                                            <div class="flex gap-2">
                                                <button onclick="editCustomAgreement(${index})" class="text-blue-500 hover:text-blue-700 px-2 py-1 rounded">✏️</button>
                                                <button onclick="removeCustomAgreement(${index})" class="text-red-500 hover:text-red-700 px-2 py-1 rounded">🗑️</button>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>

                        <div class="mt-6 pt-4 border-t">
                            <button onclick="savePaymentMethods()" class="bg-green-600 hover:bg-green-700 text-white px-8 py-3 rounded-lg transition-colors">
                                💾 Salvar Formas de Pagamento
                            </button>
                            <button onclick="clearAllPaymentMethods()" class="ml-3 bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg transition-colors">
                                🗑️ Limpar Tudo
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            setTimeout(() => {
                document.getElementById('merchantStoreForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const store = stores.find(s => s.merchantId === currentUser.id);
                    if (store) {
                        const logoFile = document.getElementById('merchantStoreLogo').files[0];
                        
                        const updateStoreData = () => {
                            store.name = document.getElementById('merchantStoreNameInput').value;
                            store.category = document.getElementById('merchantStoreCategory').value;
                            store.categories = document.getElementById('merchantStoreCategories').value.split(',').map(c => c.trim()).filter(c => c);
                            store.address = document.getElementById('merchantStoreAddress').value;
                            store.neighborhood = document.getElementById('merchantStoreNeighborhood').value;
                            store.zone = document.getElementById('merchantStoreZone').value;
                            store.state = document.getElementById('merchantStoreState').value;
                            store.phone = document.getElementById('merchantStorePhone').value;
                            store.emoji = document.getElementById('merchantStoreEmoji').value;
                            store.description = document.getElementById('merchantStoreDescription').value;
                            
                            // Update merchant store name
                            document.getElementById('merchantStoreName').textContent = store.name;
                            
                            alert('Informações da loja atualizadas com sucesso!');
                            renderStores();
                            populateLocationFilters();
                        };
                        
                        if (logoFile) {
                            if (logoFile.size > 2 * 1024 * 1024) {
                                alert('Logo muito grande! Máximo 2MB.');
                                return;
                            }
                            
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                store.logo = e.target.result;
                                updateStoreData();
                            };
                            reader.readAsDataURL(logoFile);
                        } else {
                            updateStoreData();
                        }
                    }
                });
            }, 100);
        }

        // Payment methods data
        function getAvailableCards() {
            return [
                { id: 'visa', name: 'Visa', logo: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCA0MCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjI0IiByeD0iNCIgZmlsbD0iIzAwNTFBNSIvPgo8dGV4dCB4PSI1IiB5PSIxNSIgZmlsbD0id2hpdGUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxMCIgZm9udC13ZWlnaHQ9ImJvbGQiPlZJU0E8L3RleHQ+Cjwvc3ZnPgo=' },
                { id: 'mastercard', name: 'Mastercard', logo: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCA0MCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjI0IiByeD0iNCIgZmlsbD0iI0VCMDAxQiIvPgo8Y2lyY2xlIGN4PSIxNSIgY3k9IjEyIiByPSI2IiBmaWxsPSIjRkY1RjAwIiBmaWxsLW9wYWNpdHk9IjAuNyIvPgo8Y2lyY2xlIGN4PSIyNSIgY3k9IjEyIiByPSI2IiBmaWxsPSIjRkY1RjAwIiBmaWxsLW9wYWNpdHk9IjAuNyIvPgo8L3N2Zz4K' },
                { id: 'elo', name: 'Elo', logo: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCA0MCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjI0IiByeD0iNCIgZmlsbD0iI0ZGRkYwMCIvPgo8dGV4dCB4PSIxMiIgeT0iMTUiIGZpbGw9ImJsYWNrIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTAiIGZvbnQtd2VpZ2h0PSJib2xkIj5FTE88L3RleHQ+Cjwvc3ZnPgo=' },
                { id: 'amex', name: 'American Express', logo: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCA0MCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjI0IiByeD0iNCIgZmlsbD0iIzAwNkZDRiIvPgo8dGV4dCB4PSI4IiB5PSIxNSIgZmlsbD0id2hpdGUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSI4IiBmb250LXdlaWdodD0iYm9sZCI+QU1FWDwvdGV4dD4KPC9zdmc+Cg==' },
                { id: 'hipercard', name: 'Hipercard', logo: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCA0MCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjI0IiByeD0iNCIgZmlsbD0iI0VEMUMyNCIvPgo8dGV4dCB4PSI4IiB5PSIxNSIgZmlsbD0id2hpdGUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSI3IiBmb250LXdlaWdodD0iYm9sZCI+SElQRVI8L3RleHQ+Cjwvc3ZnPgo=' },
                { id: 'diners', name: 'Diners Club', logo: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCA0MCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjI0IiByeD0iNCIgZmlsbD0iIzAwNjVBNCIvPgo8dGV4dCB4PSI2IiB5PSIxNSIgZmlsbD0id2hpdGUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSI3IiBmb250LXdlaWdodD0iYm9sZCI+RElORVJTPC90ZXh0Pgo8L3N2Zz4K' },
                { id: 'discover', name: 'Discover', logo: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCA0MCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjI0IiByeD0iNCIgZmlsbD0iI0ZGNjAwMCIvPgo8dGV4dCB4PSI0IiB5PSIxNSIgZmlsbD0id2hpdGUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSI3IiBmb250LXdlaWdodD0iYm9sZCI+RElTQ09WRVI8L3RleHQ+Cjwvc3ZnPgo=' },
                { id: 'jcb', name: 'JCB', logo: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCA0MCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjI0IiByeD0iNCIgZmlsbD0iIzAwNjlBNyIvPgo8dGV4dCB4PSIxNCIgeT0iMTUiIGZpbGw9IndoaXRlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTAiIGZvbnQtd2VpZ2h0PSJib2xkIj5KQ0I8L3RleHQ+Cjwvc3ZnPgo=' }
            ];
        }

        function getOtherPaymentMethods() {
            return [
                { id: 'pix', name: 'PIX', icon: '📱' },
                { id: 'dinheiro', name: 'Dinheiro', icon: '💵' },
                { id: 'cheque', name: 'Cheque', icon: '📝' },
                { id: 'transferencia', name: 'Transferência', icon: '🏦' },
                { id: 'boleto', name: 'Boleto', icon: '📄' },
                { id: 'vale_alimentacao', name: 'Vale Alimentação', icon: '🍽️' },
                { id: 'vale_refeicao', name: 'Vale Refeição', icon: '🥘' }
            ];
        }

        function getAvailableAgreements() {
            return [
                { id: 'unimed', name: 'Unimed', description: 'Planos de saúde Unimed', icon: '🏥' },
                { id: 'bradesco_saude', name: 'Bradesco Saúde', description: 'Planos de saúde Bradesco', icon: '🏥' },
                { id: 'amil', name: 'Amil', description: 'Planos de saúde Amil', icon: '🏥' },
                { id: 'sulamerica', name: 'SulAmérica', description: 'Planos de saúde SulAmérica', icon: '🏥' },
                { id: 'golden_cross', name: 'Golden Cross', description: 'Planos de saúde Golden Cross', icon: '🏥' },
                { id: 'hapvida', name: 'Hapvida', description: 'Planos de saúde Hapvida', icon: '🏥' },
                { id: 'prevent_senior', name: 'Prevent Senior', description: 'Planos de saúde Prevent Senior', icon: '🏥' },
                { id: 'porto_seguro', name: 'Porto Seguro Saúde', description: 'Planos de saúde Porto Seguro', icon: '🏥' },
                { id: 'odonto_empresas', name: 'Odonto Empresas', description: 'Convênios odontológicos', icon: '🦷' },
                { id: 'metlife', name: 'MetLife', description: 'Planos odontológicos MetLife', icon: '🦷' },
                { id: 'ticket_alimentacao', name: 'Ticket Alimentação', description: 'Vale alimentação Ticket', icon: '🎫' },
                { id: 'sodexo', name: 'Sodexo', description: 'Vale alimentação/refeição Sodexo', icon: '🎫' },
                { id: 'alelo', name: 'Alelo', description: 'Vale alimentação/refeição Alelo', icon: '🎫' },
                { id: 'vr_beneficios', name: 'VR Benefícios', description: 'Vale alimentação/refeição VR', icon: '🎫' }
            ];
        }

        // Payment methods management functions
        function togglePaymentMethod(type, methodId) {
            const store = stores.find(s => s.merchantId === currentUser.id);
            if (!store.paymentMethods[type]) {
                store.paymentMethods[type] = [];
            }
            
            const index = store.paymentMethods[type].indexOf(methodId);
            if (index > -1) {
                store.paymentMethods[type].splice(index, 1);
            } else {
                store.paymentMethods[type].push(methodId);
            }
            
            // Update visual state
            showStoreSettings();
        }

        function savePaymentMethods() {
            const store = stores.find(s => s.merchantId === currentUser.id);
            const totalMethods = (store.paymentMethods.cards?.length || 0) + 
                               (store.paymentMethods.others?.length || 0) + 
                               (store.paymentMethods.agreements?.length || 0) +
                               (store.paymentMethods.customAgreements?.length || 0);
            
            alert(`Formas de pagamento salvas com sucesso!\n\nTotal configurado: ${totalMethods} métodos de pagamento`);
            renderStores(); // Update store display with payment methods
        }

        function clearAllPaymentMethods() {
            if (confirm('Tem certeza que deseja remover todas as formas de pagamento configuradas?')) {
                const store = stores.find(s => s.merchantId === currentUser.id);
                store.paymentMethods = {
                    cards: [],
                    others: [],
                    agreements: [],
                    customAgreements: []
                };
                showStoreSettings();
                alert('Todas as formas de pagamento foram removidas.');
            }
        }

        function addCustomAgreement() {
            const name = document.getElementById('customAgreementName').value.trim();
            const description = document.getElementById('customAgreementDescription').value.trim();
            
            if (!name) {
                alert('Por favor, digite o nome do convênio.');
                return;
            }
            
            const store = stores.find(s => s.merchantId === currentUser.id);
            if (!store.paymentMethods.customAgreements) {
                store.paymentMethods.customAgreements = [];
            }
            
            // Check if already exists
            if (store.paymentMethods.customAgreements.some(a => a.name.toLowerCase() === name.toLowerCase())) {
                alert('Este convênio já foi adicionado.');
                return;
            }
            
            store.paymentMethods.customAgreements.push({
                name: name,
                description: description || '',
                id: Date.now().toString()
            });
            
            // Clear form
            document.getElementById('customAgreementName').value = '';
            document.getElementById('customAgreementDescription').value = '';
            
            showStoreSettings();
            alert(`Convênio "${name}" adicionado com sucesso!`);
        }

        function editCustomAgreement(index) {
            const store = stores.find(s => s.merchantId === currentUser.id);
            const agreement = store.paymentMethods.customAgreements[index];
            
            const newName = prompt('Nome do convênio:', agreement.name);
            if (newName === null) return;
            
            const newDescription = prompt('Descrição (opcional):', agreement.description || '');
            if (newDescription === null) return;
            
            if (!newName.trim()) {
                alert('O nome do convênio não pode estar vazio.');
                return;
            }
            
            agreement.name = newName.trim();
            agreement.description = newDescription.trim();
            
            showStoreSettings();
            alert('Convênio atualizado com sucesso!');
        }

        function removeCustomAgreement(index) {
            const store = stores.find(s => s.merchantId === currentUser.id);
            const agreement = store.paymentMethods.customAgreements[index];
            
            if (confirm(`Tem certeza que deseja remover o convênio "${agreement.name}"?`)) {
                store.paymentMethods.customAgreements.splice(index, 1);
                showStoreSettings();
                alert(`Convênio "${agreement.name}" removido com sucesso!`);
            }
        }

        function showProductsManagement() {
            const store = stores.find(s => s.merchantId === currentUser.id);
            if (!store.products) store.products = [];
            
            const content = document.getElementById('merchantContent');
            content.innerHTML = `
                <h3 class="text-xl font-bold mb-4">📦 Gerenciar Produtos/Serviços</h3>
                
                <!-- Add Product Form -->
                <div class="bg-gray-50 p-6 rounded-lg mb-6">
                    <h4 class="text-lg font-semibold mb-4">Adicionar Novo Produto/Serviço</h4>
                    <form id="addProductForm">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Nome do Produto/Serviço</label>
                                <input type="text" id="productName" placeholder="Ex: Pão Francês, Corte de Cabelo" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Preço (R$)</label>
                                <input type="number" id="productPrice" step="0.01" placeholder="0.00" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Categoria</label>
                                <select id="productCategory" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                    <option value="">Selecione uma categoria</option>
                                    <option value="produto">Produto</option>
                                    <option value="servico">Serviço</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Emoji</label>
                                <input type="text" id="productEmoji" placeholder="🥖" maxlength="2" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Imagem do Produto</label>
                                <input type="file" id="productImage" accept="image/*" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <p class="text-sm text-gray-500 mt-1">Opcional - Máximo 2MB</p>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-gray-700 font-medium mb-2">Descrição</label>
                                <textarea id="productDescription" placeholder="Descreva seu produto ou serviço..." class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 h-20"></textarea>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Disponível</label>
                                <select id="productAvailable" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="true">Sim</option>
                                    <option value="false">Não</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Estoque (opcional)</label>
                                <input type="number" id="productStock" placeholder="Deixe vazio se ilimitado" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        <div class="mt-4">
                            <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition-colors">
                                Adicionar Produto/Serviço
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Products List -->
                <div class="bg-white rounded-lg">
                    <h4 class="text-lg font-semibold mb-4 p-4 border-b">Produtos/Serviços Cadastrados</h4>
                    <div id="productsList" class="p-4">
                        ${store.products.length === 0 ? 
                            '<p class="text-gray-500 text-center py-8">Nenhum produto ou serviço cadastrado ainda.</p>' :
                            store.products.map((product, index) => `
                                <div class="border rounded-lg p-4 mb-4 ${!product.available ? 'bg-gray-50' : ''}">
                                    <div class="flex justify-between items-start">
                                        <div class="flex-1">
                                            <div class="flex items-center mb-2">
                                                ${product.image ? 
                                                    `<img src="${product.image}" class="w-12 h-12 rounded-lg object-cover mr-3">` :
                                                    `<span class="text-2xl mr-3">${product.emoji || '📦'}</span>`
                                                }
                                                <div>
                                                    <h5 class="font-bold text-lg">${product.name}</h5>
                                                    <div class="flex items-center gap-4 text-sm text-gray-600">
                                                        <span class="font-semibold text-green-600">R$ ${product.price.toFixed(2)}</span>
                                                        <span class="px-2 py-1 rounded text-xs ${product.category === 'produto' ? 'bg-blue-100 text-blue-800' : 'bg-purple-100 text-purple-800'}">${product.category}</span>
                                                        <span class="px-2 py-1 rounded text-xs ${product.available ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">${product.available ? 'Disponível' : 'Indisponível'}</span>
                                                        ${product.stock ? `<span class="text-gray-500">Estoque: ${product.stock}</span>` : ''}
                                                    </div>
                                                </div>
                                            </div>
                                            ${product.description ? `<p class="text-gray-600 ml-15">${product.description}</p>` : ''}
                                        </div>
                                        <div class="flex gap-2 ml-4">
                                            <button onclick="editProduct(${index})" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">Editar</button>
                                            <button onclick="toggleProductAvailability(${index})" class="bg-yellow-500 text-white px-3 py-1 rounded text-sm hover:bg-yellow-600">${product.available ? 'Desativar' : 'Ativar'}</button>
                                            <button onclick="deleteProduct(${index})" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600">Excluir</button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')
                        }
                    </div>
                </div>
            `;
            
            // Add form event listener
            setTimeout(() => {
                document.getElementById('addProductForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    addProduct();
                });
            }, 100);
        }

        function addProduct() {
            const store = stores.find(s => s.merchantId === currentUser.id);
            if (!store.products) store.products = [];
            
            const imageFile = document.getElementById('productImage').files[0];
            
            const product = {
                id: Date.now(),
                name: document.getElementById('productName').value,
                price: parseFloat(document.getElementById('productPrice').value),
                category: document.getElementById('productCategory').value,
                emoji: document.getElementById('productEmoji').value || '📦',
                description: document.getElementById('productDescription').value,
                available: document.getElementById('productAvailable').value === 'true',
                stock: document.getElementById('productStock').value ? parseInt(document.getElementById('productStock').value) : null,
                createdAt: new Date()
            };
            
            if (imageFile) {
                if (imageFile.size > 2 * 1024 * 1024) {
                    alert('Imagem muito grande! Máximo 2MB.');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    product.image = e.target.result;
                    store.products.push(product);
                    alert('Produto/Serviço adicionado com sucesso!');
                    showProductsManagement();
                };
                reader.readAsDataURL(imageFile);
            } else {
                store.products.push(product);
                alert('Produto/Serviço adicionado com sucesso!');
                showProductsManagement();
            }
        }

        function editProduct(index) {
            const store = stores.find(s => s.merchantId === currentUser.id);
            const product = store.products[index];
            
            // Create edit modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 max-h-screen overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold">✏️ Editar ${product.category === 'produto' ? 'Produto' : 'Serviço'}</h2>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">×</button>
                    </div>
                    
                    <form id="editProductForm">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Nome</label>
                                <input type="text" id="editProductName" value="${product.name}" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Preço (R$)</label>
                                <input type="number" id="editProductPrice" value="${product.price}" step="0.01" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Categoria</label>
                                <select id="editProductCategory" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                    <option value="produto" ${product.category === 'produto' ? 'selected' : ''}>Produto</option>
                                    <option value="servico" ${product.category === 'servico' ? 'selected' : ''}>Serviço</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Emoji</label>
                                <input type="text" id="editProductEmoji" value="${product.emoji || ''}" maxlength="2" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Descrição</label>
                                <textarea id="editProductDescription" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 h-20">${product.description || ''}</textarea>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Disponível</label>
                                <select id="editProductAvailable" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="true" ${product.available ? 'selected' : ''}>Sim</option>
                                    <option value="false" ${!product.available ? 'selected' : ''}>Não</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Estoque (opcional)</label>
                                <input type="number" id="editProductStock" value="${product.stock || ''}" placeholder="Deixe vazio se ilimitado" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            ${product.category === 'servico' ? `
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">Duração (opcional)</label>
                                    <input type="text" id="editProductDuration" value="${product.duration || ''}" placeholder="Ex: 30min, 1h, 2h30min" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                            ` : ''}
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Nova Imagem (opcional)</label>
                                <input type="file" id="editProductImage" accept="image/*" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <p class="text-sm text-gray-500 mt-1">Deixe vazio para manter a imagem atual</p>
                                ${product.image ? `
                                    <div class="mt-2">
                                        <img src="${product.image}" class="w-16 h-16 rounded-lg object-cover">
                                        <button type="button" onclick="removeProductImage(${index})" class="text-red-500 text-sm mt-1">Remover imagem atual</button>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        <div class="mt-6 flex gap-3">
                            <button type="submit" class="flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors">
                                💾 Salvar Alterações
                            </button>
                            <button type="button" onclick="this.closest('.fixed').remove()" class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                Cancelar
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add form event listener
            document.getElementById('editProductForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const imageFile = document.getElementById('editProductImage').files[0];
                
                const updateProduct = (newImage = null) => {
                    product.name = document.getElementById('editProductName').value;
                    product.price = parseFloat(document.getElementById('editProductPrice').value);
                    product.category = document.getElementById('editProductCategory').value;
                    product.emoji = document.getElementById('editProductEmoji').value || '📦';
                    product.description = document.getElementById('editProductDescription').value;
                    product.available = document.getElementById('editProductAvailable').value === 'true';
                    product.stock = document.getElementById('editProductStock').value ? parseInt(document.getElementById('editProductStock').value) : null;
                    
                    if (product.category === 'servico') {
                        const durationInput = document.getElementById('editProductDuration');
                        if (durationInput) {
                            product.duration = durationInput.value;
                        }
                    }
                    
                    if (newImage) {
                        product.image = newImage;
                    }
                    
                    modal.remove();
                    showProductsManagement();
                    alert('Produto/Serviço atualizado com sucesso!');
                };
                
                if (imageFile) {
                    if (imageFile.size > 2 * 1024 * 1024) {
                        alert('Imagem muito grande! Máximo 2MB.');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        updateProduct(e.target.result);
                    };
                    reader.readAsDataURL(imageFile);
                } else {
                    updateProduct();
                }
            });
        }

        function removeProductImage(index) {
            const store = stores.find(s => s.merchantId === currentUser.id);
            const product = store.products[index];
            
            if (confirm('Tem certeza que deseja remover a imagem deste produto?')) {
                delete product.image;
                // Close modal and refresh
                document.querySelector('.fixed').remove();
                editProduct(index);
            }
        }

        function toggleProductAvailability(index) {
            const store = stores.find(s => s.merchantId === currentUser.id);
            const product = store.products[index];
            product.available = !product.available;
            
            const statusText = product.available ? 'disponível' : 'indisponível';
            alert(`${product.name} agora está ${statusText}!`);
            showProductsManagement();
        }

        function deleteProduct(index) {
            const store = stores.find(s => s.merchantId === currentUser.id);
            const product = store.products[index];
            
            if (confirm(`Tem certeza que deseja excluir "${product.name}"?\n\nEsta ação não pode ser desfeita.`)) {
                store.products.splice(index, 1);
                alert(`"${product.name}" foi excluído com sucesso!`);
                showProductsManagement();
            }
        }

        function removeStoreLogo() {
            const store = stores.find(s => s.merchantId === currentUser.id);
            if (store && confirm('Tem certeza que deseja remover o logo da loja?')) {
                delete store.logo;
                showStoreSettings();
                renderStores();
                alert('Logo removido com sucesso!');
            }
        }

        function showCalendarManagement() {
            const store = stores.find(s => s.merchantId === currentUser.id);
            if (!store.calendar) store.calendar = {};
            if (!store.appointments) store.appointments = [];
            
            const content = document.getElementById('merchantContent');
            content.innerHTML = `
                <h3 class="text-xl font-bold mb-4">📅 Gerenciar Agenda</h3>
                
                <!-- Calendar Controls -->
                <div class="bg-white rounded-lg p-6 mb-6 shadow-lg">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="text-lg font-semibold">Configurar Horários Disponíveis</h4>
                        <div class="flex gap-2">
                            <button onclick="prevMonth()" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">←</button>
                            <span id="currentMonth" class="px-4 py-1 font-medium"></span>
                            <button onclick="nextMonth()" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">→</button>
                        </div>
                    </div>
                    
                    <!-- Add Available Time Slot -->
                    <div class="bg-gray-50 p-4 rounded-lg mb-4">
                        <h5 class="font-medium mb-3">Adicionar Horário Disponível</h5>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                            <input type="date" id="availableDate" class="px-3 py-2 border rounded-lg">
                            <input type="time" id="availableTime" class="px-3 py-2 border rounded-lg">
                            <select id="availableService" class="px-3 py-2 border rounded-lg">
                                <option value="">Selecione um serviço</option>
                                ${store.products?.filter(p => p.category === 'servico').map(p => 
                                    `<option value="${p.id}">${p.name} - R$ ${p.price.toFixed(2)}</option>`
                                ).join('') || '<option value="geral">Serviço Geral</option>'}
                            </select>
                            <button onclick="addAvailableSlot()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                                Adicionar
                            </button>
                        </div>
                    </div>
                    
                    <!-- Calendar View -->
                    <div id="calendarView" class="mb-4">
                        <!-- Calendar will be rendered here -->
                    </div>
                </div>
                
                <!-- Appointments List -->
                <div class="bg-white rounded-lg p-6 shadow-lg">
                    <h4 class="text-lg font-semibold mb-4">Agendamentos</h4>
                    <div id="appointmentsList">
                        ${store.appointments.length === 0 ? 
                            '<p class="text-gray-500 text-center py-4">Nenhum agendamento ainda.</p>' :
                            store.appointments.map(apt => `
                                <div class="border rounded-lg p-4 mb-3 ${apt.status === 'confirmed' ? 'bg-green-50 border-green-200' : apt.status === 'cancelled' ? 'bg-red-50 border-red-200' : 'bg-yellow-50 border-yellow-200'}">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <h5 class="font-medium">${apt.customerName}</h5>
                                            <p class="text-sm text-gray-600">📅 ${new Date(apt.date).toLocaleDateString('pt-BR')} às ${apt.time}</p>
                                            <p class="text-sm text-gray-600">🛍️ ${apt.serviceName}</p>
                                            <p class="text-sm text-gray-600">💰 R$ ${apt.price.toFixed(2)}</p>
                                            ${apt.customerPhone ? `<p class="text-sm text-gray-600">📞 ${apt.customerPhone}</p>` : ''}
                                        </div>
                                        <div class="flex gap-2">
                                            ${apt.status === 'pending' ? `
                                                <button onclick="confirmAppointment('${apt.id}')" class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600">Confirmar</button>
                                                <button onclick="cancelAppointment('${apt.id}')" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600">Cancelar</button>
                                            ` : `
                                                <span class="px-3 py-1 rounded text-sm ${apt.status === 'confirmed' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                                    ${apt.status === 'confirmed' ? 'Confirmado' : 'Cancelado'}
                                                </span>
                                            `}
                                        </div>
                                    </div>
                                </div>
                            `).join('')
                        }
                    </div>
                </div>
            `;
            
            renderCalendar();
        }

        // Calendar functions
        let currentCalendarDate = new Date();
        
        function renderCalendar() {
            const store = stores.find(s => s.merchantId === currentUser.id);
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            document.getElementById('currentMonth').textContent = 
                new Date(year, month).toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            let calendarHTML = `
                <div class="calendar-grid">
                    <div class="calendar-day font-bold bg-gray-100">Dom</div>
                    <div class="calendar-day font-bold bg-gray-100">Seg</div>
                    <div class="calendar-day font-bold bg-gray-100">Ter</div>
                    <div class="calendar-day font-bold bg-gray-100">Qua</div>
                    <div class="calendar-day font-bold bg-gray-100">Qui</div>
                    <div class="calendar-day font-bold bg-gray-100">Sex</div>
                    <div class="calendar-day font-bold bg-gray-100">Sáb</div>
            `;
            
            // Empty cells for days before month starts
            for (let i = 0; i < firstDay; i++) {
                calendarHTML += '<div class="calendar-day unavailable"></div>';
            }
            
            // Days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const hasSlots = store.calendar[dateStr] && store.calendar[dateStr].length > 0;
                const isPast = new Date(dateStr) < new Date().setHours(0,0,0,0);
                
                calendarHTML += `
                    <div class="calendar-day ${isPast ? 'unavailable' : hasSlots ? 'bg-green-100' : ''}" 
                         onclick="${!isPast ? `showDaySlots('${dateStr}')` : ''}">
                        <div class="font-medium">${day}</div>
                        ${hasSlots ? `<div class="text-xs text-green-600">${store.calendar[dateStr].length} slots</div>` : ''}
                    </div>
                `;
            }
            
            calendarHTML += '</div>';
            document.getElementById('calendarView').innerHTML = calendarHTML;
        }
        
        function prevMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
            renderCalendar();
        }
        
        function nextMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
            renderCalendar();
        }
        
        function addAvailableSlot() {
            const store = stores.find(s => s.merchantId === currentUser.id);
            const date = document.getElementById('availableDate').value;
            const time = document.getElementById('availableTime').value;
            const serviceId = document.getElementById('availableService').value;
            
            if (!date || !time) {
                alert('Por favor, selecione data e horário.');
                return;
            }
            
            if (new Date(date) < new Date().setHours(0,0,0,0)) {
                alert('Não é possível adicionar horários em datas passadas.');
                return;
            }
            
            if (!store.calendar[date]) {
                store.calendar[date] = [];
            }
            
            // Check if time slot already exists
            if (store.calendar[date].some(slot => slot.time === time)) {
                alert('Este horário já está cadastrado para esta data.');
                return;
            }
            
            const service = store.products?.find(p => p.id == serviceId);
            const slot = {
                id: Date.now(),
                time: time,
                serviceId: serviceId || 'geral',
                serviceName: service ? service.name : 'Serviço Geral',
                price: service ? service.price : 0,
                available: true,
                customerId: null
            };
            
            store.calendar[date].push(slot);
            store.calendar[date].sort((a, b) => a.time.localeCompare(b.time));
            
            // Clear form
            document.getElementById('availableDate').value = '';
            document.getElementById('availableTime').value = '';
            document.getElementById('availableService').value = '';
            
            renderCalendar();
            alert('Horário adicionado com sucesso!');
        }
        
        function showDaySlots(date) {
            const store = stores.find(s => s.merchantId === currentUser.id);
            const slots = store.calendar[date] || [];
            
            if (slots.length === 0) {
                alert(`Nenhum horário disponível para ${new Date(date).toLocaleDateString('pt-BR')}`);
                return;
            }
            
            const slotsList = slots.map(slot => 
                `• ${slot.time} - ${slot.serviceName} ${slot.available ? '(Disponível)' : '(Ocupado)'}`
            ).join('\n');
            
            alert(`Horários para ${new Date(date).toLocaleDateString('pt-BR')}:\n\n${slotsList}`);
        }
        
        function confirmAppointment(appointmentId) {
            const store = stores.find(s => s.merchantId === currentUser.id);
            const appointment = store.appointments.find(apt => apt.id === appointmentId);
            
            if (appointment) {
                appointment.status = 'confirmed';
                showCalendarManagement();
                alert('Agendamento confirmado!');
            }
        }
        
        function cancelAppointment(appointmentId) {
            const store = stores.find(s => s.merchantId === currentUser.id);
            const appointment = store.appointments.find(apt => apt.id === appointmentId);
            
            if (appointment && confirm('Tem certeza que deseja cancelar este agendamento?')) {
                appointment.status = 'cancelled';
                
                // Make the slot available again
                const dateStr = appointment.date;
                if (store.calendar[dateStr]) {
                    const slot = store.calendar[dateStr].find(s => s.time === appointment.time);
                    if (slot) {
                        slot.available = true;
                        slot.customerId = null;
                    }
                }
                
                showCalendarManagement();
                alert('Agendamento cancelado!');
            }
        }

        // Customer functions
        function showMyAppointmentsList() {
            const content = document.getElementById('customerContent');
            
            // Find all appointments for current customer
            const myAppointments = [];
            stores.forEach(store => {
                if (store.appointments) {
                    store.appointments.forEach(apt => {
                        if (apt.customerId === currentUser.id) {
                            myAppointments.push({
                                ...apt,
                                storeName: store.name,
                                storePhone: store.phone
                            });
                        }
                    });
                }
            });
            
            content.innerHTML = `
                <h3 class="text-xl font-bold mb-4">📅 Meus Agendamentos</h3>
                
                <div class="space-y-4">
                    ${myAppointments.length === 0 ? 
                        '<div class="text-center py-8"><p class="text-gray-500">Você ainda não tem agendamentos.</p></div>' :
                        myAppointments.sort((a, b) => new Date(a.date) - new Date(b.date)).map(apt => {
                            const appointmentDate = new Date(apt.date);
                            const isPast = appointmentDate < new Date().setHours(0,0,0,0);
                            const statusColor = apt.status === 'confirmed' ? 'green' : apt.status === 'cancelled' ? 'red' : 'yellow';
                            const statusText = apt.status === 'confirmed' ? 'Confirmado' : apt.status === 'cancelled' ? 'Cancelado' : 'Pendente';
                            const statusIcon = apt.status === 'confirmed' ? '✅' : apt.status === 'cancelled' ? '❌' : '⏳';
                            
                            return `
                                <div class="bg-white border rounded-lg p-6 shadow-lg ${apt.status === 'cancelled' ? 'opacity-75' : ''} ${isPast && apt.status === 'confirmed' ? 'bg-gray-50' : ''}">
                                    <div class="flex justify-between items-start">
                                        <div class="flex-1">
                                            <div class="flex items-center gap-3 mb-3">
                                                <h4 class="text-lg font-bold">${apt.storeName}</h4>
                                                <span class="px-3 py-1 rounded-full text-sm font-medium bg-${statusColor}-100 text-${statusColor}-800">
                                                    ${statusIcon} ${statusText}
                                                </span>
                                                ${isPast && apt.status === 'confirmed' ? '<span class="px-2 py-1 bg-gray-100 text-gray-600 rounded text-xs">Realizado</span>' : ''}
                                            </div>
                                            
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600">
                                                <div class="space-y-2">
                                                    <div class="flex items-center">
                                                        <span class="mr-2">📅</span>
                                                        <span class="font-medium">${appointmentDate.toLocaleDateString('pt-BR', { 
                                                            weekday: 'long', 
                                                            day: '2-digit', 
                                                            month: '2-digit', 
                                                            year: 'numeric' 
                                                        })}</span>
                                                    </div>
                                                    <div class="flex items-center">
                                                        <span class="mr-2">⏰</span>
                                                        <span>${apt.time}</span>
                                                    </div>
                                                    <div class="flex items-center">
                                                        <span class="mr-2">🛍️</span>
                                                        <span class="font-medium">${apt.serviceName}</span>
                                                    </div>
                                                </div>
                                                <div class="space-y-2">
                                                    <div class="flex items-center">
                                                        <span class="mr-2">💰</span>
                                                        <span class="font-semibold text-green-600">R$ ${apt.price.toFixed(2)}</span>
                                                    </div>
                                                    <div class="flex items-center">
                                                        <span class="mr-2">📞</span>
                                                        <span>${apt.storePhone}</span>
                                                    </div>
                                                    <div class="flex items-center">
                                                        <span class="mr-2">📝</span>
                                                        <span class="text-xs">Agendado em ${new Date(apt.createdAt).toLocaleDateString('pt-BR')}</span>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            ${apt.notes ? `
                                                <div class="mt-3 p-3 bg-gray-50 rounded-lg">
                                                    <div class="flex items-start">
                                                        <span class="mr-2 text-gray-500">💬</span>
                                                        <div>
                                                            <span class="text-sm font-medium text-gray-700">Suas observações:</span>
                                                            <p class="text-sm text-gray-600 mt-1">${apt.notes}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            ` : ''}
                                        </div>
                                        
                                        <div class="flex flex-col gap-2 ml-4">
                                            ${apt.status === 'pending' && !isPast ? `
                                                <button onclick="cancelMyAppointment('${apt.id}')" class="bg-red-500 text-white px-4 py-2 rounded text-sm hover:bg-red-600 whitespace-nowrap">
                                                    ❌ Cancelar
                                                </button>
                                            ` : ''}
                                            <button onclick="contactStore(${stores.find(s => s.name === apt.storeName)?.id})" class="bg-green-600 text-white px-4 py-2 rounded text-sm hover:bg-green-700 whitespace-nowrap">
                                                📞 Contatar Loja
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')
                    }
                </div>
            `;
        }

        function showMyReservationsList() {
            const content = document.getElementById('customerContent');
            
            // Find all reservations for current customer
            const myReservations = [];
            stores.forEach(store => {
                if (store.reservations) {
                    store.reservations.forEach(res => {
                        if (res.customerId === currentUser.id) {
                            myReservations.push({
                                ...res,
                                storeName: store.name,
                                storePhone: store.phone
                            });
                        }
                    });
                }
            });
            
            content.innerHTML = `
                <h3 class="text-xl font-bold mb-4">🛒 Minhas Reservas</h3>
                
                <div class="space-y-4">
                    ${myReservations.length === 0 ? 
                        '<div class="text-center py-8"><p class="text-gray-500">Você ainda não tem reservas.</p></div>' :
                        myReservations.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)).map(res => {
                            const pickupDate = new Date(res.pickupDate);
                            const isPast = pickupDate < new Date().setHours(0,0,0,0);
                            const isOverdue = isPast && res.status === 'confirmed';
                            const statusColor = res.status === 'confirmed' ? 'green' : res.status === 'cancelled' ? 'red' : res.status === 'completed' ? 'blue' : 'yellow';
                            const statusText = res.status === 'confirmed' ? 'Confirmado' : res.status === 'cancelled' ? 'Cancelado' : res.status === 'completed' ? 'Retirado' : 'Pendente';
                            const statusIcon = res.status === 'confirmed' ? '✅' : res.status === 'cancelled' ? '❌' : res.status === 'completed' ? '✔️' : '⏳';
                            
                            return `
                                <div class="bg-white border rounded-lg p-6 shadow-lg ${res.status === 'cancelled' ? 'opacity-75' : ''} ${isOverdue ? 'border-red-300 bg-red-50' : ''}">
                                    <div class="flex justify-between items-start">
                                        <div class="flex-1">
                                            <div class="flex items-center gap-3 mb-3">
                                                <h4 class="text-lg font-bold">${res.storeName}</h4>
                                                <span class="px-3 py-1 rounded-full text-sm font-medium bg-${statusColor}-100 text-${statusColor}-800">
                                                    ${statusIcon} ${statusText}
                                                </span>
                                                ${isOverdue ? '<span class="px-2 py-1 bg-red-100 text-red-800 rounded text-xs font-medium">Atrasado</span>' : ''}
                                            </div>
                                            
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600 mb-3">
                                                <div class="space-y-2">
                                                    <div class="flex items-center">
                                                        <span class="mr-2">📦</span>
                                                        <span class="font-medium">${res.productName}</span>
                                                    </div>
                                                    <div class="flex items-center">
                                                        <span class="mr-2">📊</span>
                                                        <span>Quantidade: ${res.quantity}</span>
                                                    </div>
                                                    <div class="flex items-center">
                                                        <span class="mr-2">💰</span>
                                                        <span class="font-semibold text-green-600">R$ ${res.totalPrice.toFixed(2)}</span>
                                                        <span class="text-xs text-gray-500 ml-2">(R$ ${res.unitPrice.toFixed(2)} cada)</span>
                                                    </div>
                                                </div>
                                                <div class="space-y-2">
                                                    <div class="flex items-center">
                                                        <span class="mr-2">📅</span>
                                                        <span class="font-medium">Retirada: ${pickupDate.toLocaleDateString('pt-BR', { 
                                                            weekday: 'short', 
                                                            day: '2-digit', 
                                                            month: '2-digit' 
                                                        })}</span>
                                                    </div>
                                                    <div class="flex items-center">
                                                        <span class="mr-2">📞</span>
                                                        <span>${res.storePhone}</span>
                                                    </div>
                                                    <div class="flex items-center">
                                                        <span class="mr-2">📝</span>
                                                        <span class="text-xs">Reservado em ${new Date(res.createdAt).toLocaleDateString('pt-BR')}</span>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            ${res.notes ? `
                                                <div class="bg-gray-50 p-3 rounded-lg">
                                                    <div class="flex items-start">
                                                        <span class="mr-2 text-gray-500">💬</span>
                                                        <div>
                                                            <span class="text-sm font-medium text-gray-700">Suas observações:</span>
                                                            <p class="text-sm text-gray-600 mt-1">${res.notes}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            ` : ''}
                                        </div>
                                        
                                        <div class="flex flex-col gap-2 ml-4">
                                            ${res.status === 'pending' ? `
                                                <button onclick="cancelMyReservation('${res.id}')" class="bg-red-500 text-white px-4 py-2 rounded text-sm hover:bg-red-600 whitespace-nowrap">
                                                    ❌ Cancelar
                                                </button>
                                            ` : ''}
                                            <button onclick="contactStore(${stores.find(s => s.name === res.storeName)?.id})" class="bg-green-600 text-white px-4 py-2 rounded text-sm hover:bg-green-700 whitespace-nowrap">
                                                📞 Contatar Loja
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')
                    }
                </div>
            `;
        }

        function showMyFavoritesList() {
            const content = document.getElementById('customerContent');
            const favoriteStores = stores.filter(s => currentUser.favoriteStores?.includes(s.id));
            
            content.innerHTML = `
                <h3 class="text-xl font-bold mb-4">❤️ Minhas Lojas Favoritas</h3>
                
                <div class="space-y-4">
                    ${favoriteStores.length === 0 ? 
                        '<div class="text-center py-8"><p class="text-gray-500">Você ainda não tem lojas favoritas.</p></div>' :
                        favoriteStores.map(store => `
                            <div class="bg-white border rounded-lg p-6 shadow-lg">
                                <div class="flex justify-between items-start">
                                    <div class="flex items-center">
                                        <div class="w-16 h-16 rounded-lg overflow-hidden bg-gray-100 flex items-center justify-center mr-4">
                                            ${store.logo ? 
                                                `<img src="${store.logo}" class="w-full h-full object-cover">` :
                                                `<span class="text-2xl">${store.emoji}</span>`
                                            }
                                        </div>
                                        <div class="flex-1">
                                            <h4 class="text-lg font-bold">${store.name}</h4>
                                            <p class="text-gray-600 mb-2">${store.description}</p>
                                            <div class="flex items-center gap-4 text-sm text-gray-600">
                                                <span class="flex items-center"><span class="text-yellow-500">⭐</span> ${store.rating}</span>
                                                <span>📍 ${store.distance}</span>
                                                <span>📞 ${store.phone}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex gap-2 ml-4">
                                        <button onclick="viewStoreDetails(${store.id})" class="bg-blue-600 text-white px-4 py-2 rounded text-sm hover:bg-blue-700">
                                            Ver Detalhes
                                        </button>
                                        <button onclick="toggleStoreFavorite(${store.id})" class="bg-red-600 text-white px-4 py-2 rounded text-sm hover:bg-red-700">
                                            💔 Remover
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('')
                    }
                </div>
            `;
        }

        function showMyProfile() {
            const content = document.getElementById('customerContent');
            
            content.innerHTML = `
                <h3 class="text-xl font-bold mb-4">👤 Meu Perfil</h3>
                
                <div class="bg-white rounded-lg p-6 shadow-lg">
                    <form id="customerProfileForm">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Nome Completo</label>
                                <input type="text" id="customerProfileName" value="${currentUser.name}" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" required>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Email</label>
                                <input type="email" id="customerProfileEmail" value="${currentUser.email}" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" required>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Telefone</label>
                                <input type="tel" id="customerProfilePhone" value="${currentUser.phone || ''}" placeholder="(11) 99999-9999" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Nova Senha (opcional)</label>
                                <input type="password" id="customerProfilePassword" placeholder="Deixe vazio para manter atual" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-gray-700 font-medium mb-2">Endereço</label>
                                <input type="text" id="customerProfileAddress" value="${currentUser.address || ''}" placeholder="Endereço completo (opcional)" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                            </div>
                        </div>
                        
                        <div class="mt-6">
                            <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-8 py-3 rounded-lg transition-colors">
                                💾 Salvar Alterações
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Statistics -->
                <div class="mt-6 grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="bg-white rounded-lg p-4 shadow-lg text-center">
                        <div class="text-2xl font-bold text-blue-600">${currentUser.favoriteStores?.length || 0}</div>
                        <div class="text-sm text-gray-600">Lojas Favoritas</div>
                    </div>
                    <div class="bg-white rounded-lg p-4 shadow-lg text-center">
                        <div class="text-2xl font-bold text-green-600">${getCustomerAppointmentsCount()}</div>
                        <div class="text-sm text-gray-600">Agendamentos</div>
                    </div>
                    <div class="bg-white rounded-lg p-4 shadow-lg text-center">
                        <div class="text-2xl font-bold text-purple-600">${getCustomerReservationsCount()}</div>
                        <div class="text-sm text-gray-600">Reservas</div>
                    </div>
                    <div class="bg-white rounded-lg p-4 shadow-lg text-center">
                        <div class="text-2xl font-bold text-yellow-600">${currentUser.likedStores?.length || 0}</div>
                        <div class="text-sm text-gray-600">Curtidas</div>
                    </div>
                </div>
            `;
            
            // Add form event listener
            setTimeout(() => {
                document.getElementById('customerProfileForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const name = document.getElementById('customerProfileName').value;
                    const email = document.getElementById('customerProfileEmail').value;
                    const phone = document.getElementById('customerProfilePhone').value;
                    const password = document.getElementById('customerProfilePassword').value;
                    const address = document.getElementById('customerProfileAddress').value;
                    
                    // Check if email is already used by another customer
                    const existingCustomer = customers.find(c => c.email === email && c.id !== currentUser.id);
                    if (existingCustomer) {
                        alert('Este email já está sendo usado por outro cliente!');
                        return;
                    }
                    
                    // Update customer data
                    const customer = customers.find(c => c.id === currentUser.id);
                    if (customer) {
                        customer.name = name;
                        customer.email = email;
                        customer.phone = phone;
                        customer.address = address;
                        
                        if (password) {
                            customer.password = password;
                        }
                        
                        // Update current user
                        currentUser.name = name;
                        currentUser.email = email;
                        currentUser.phone = phone;
                        currentUser.address = address;
                        
                        // Update header display
                        document.getElementById('customerHeaderName').textContent = name;
                        document.getElementById('customerSidebarName').textContent = name;
                        document.getElementById('customerPanelName').textContent = name;
                        
                        alert('Perfil atualizado com sucesso!');
                    }
                });
            }, 100);
        }

        function getCustomerAppointmentsCount() {
            let count = 0;
            stores.forEach(store => {
                if (store.appointments) {
                    count += store.appointments.filter(apt => apt.customerId === currentUser.id).length;
                }
            });
            return count;
        }

        function getCustomerReservationsCount() {
            let count = 0;
            stores.forEach(store => {
                if (store.reservations) {
                    count += store.reservations.filter(res => res.customerId === currentUser.id).length;
                }
            });
            return count;
        }

        function toggleStoreFavorite(storeId) {
            if (!currentUser.favoriteStores) currentUser.favoriteStores = [];
            
            const index = currentUser.favoriteStores.indexOf(storeId);
            if (index > -1) {
                currentUser.favoriteStores.splice(index, 1);
            } else {
                currentUser.favoriteStores.push(storeId);
            }
            
            // Update customer in array
            const customer = customers.find(c => c.id === currentUser.id);
            if (customer) {
                customer.favoriteStores = currentUser.favoriteStores;
            }
            
            // Refresh current view
            showMyFavoritesList();
            updateCustomerStats();
        }

        function cancelMyAppointment(appointmentId) {
            // Find the appointment across all stores
            let foundAppointment = null;
            let foundStore = null;
            
            stores.forEach(store => {
                if (store.appointments) {
                    const apt = store.appointments.find(a => a.id === appointmentId);
                    if (apt) {
                        foundAppointment = apt;
                        foundStore = store;
                    }
                }
            });
            
            if (foundAppointment && confirm(`Tem certeza que deseja cancelar o agendamento de ${foundAppointment.serviceName}?`)) {
                foundAppointment.status = 'cancelled';
                
                // Make the slot available again
                const dateStr = foundAppointment.date;
                if (foundStore.calendar && foundStore.calendar[dateStr]) {
                    const slot = foundStore.calendar[dateStr].find(s => s.time === foundAppointment.time);
                    if (slot) {
                        slot.available = true;
                        slot.customerId = null;
                    }
                }
                
                showMyAppointmentsList();
                alert('Agendamento cancelado com sucesso!');
            }
        }

        function cancelMyReservation(reservationId) {
            // Find the reservation across all stores
            let foundReservation = null;
            let foundStore = null;
            
            stores.forEach(store => {
                if (store.reservations) {
                    const res = store.reservations.find(r => r.id === reservationId);
                    if (res) {
                        foundReservation = res;
                        foundStore = store;
                    }
                }
            });
            
            if (foundReservation && foundReservation.status === 'pending' && confirm(`Tem certeza que deseja cancelar a reserva de ${foundReservation.productName}?`)) {
                foundReservation.status = 'cancelled';
                
                // Restore stock if applicable
                const product = foundStore.products?.find(p => p.id === foundReservation.productId);
                if (product && product.stock !== null) {
                    product.stock += foundReservation.quantity;
                    product.available = true;
                }
                
                showMyReservationsList();
                alert('Reserva cancelada com sucesso!');
            } else if (foundReservation && foundReservation.status !== 'pending') {
                alert('Não é possível cancelar esta reserva pois ela já foi confirmada pela loja. Entre em contato diretamente.');
            }
        }

        function showCustomerProfile() {
            alert(`Perfil do Cliente:\n\nNome: ${currentUser.name}\nEmail: ${currentUser.email}\nTelefone: ${currentUser.phone || 'Não informado'}`);
        }

        function showFavoriteStores() {
            const favoriteStores = stores.filter(s => currentUser.favoriteStores?.includes(s.id));
            if (favoriteStores.length === 0) {
                alert('Você ainda não tem lojas favoritas.');
                return;
            }
            
            const storesList = favoriteStores.map(s => `• ${s.name} - ${s.description}`).join('\n');
            alert(`Suas Lojas Favoritas:\n\n${storesList}`);
        }
        
        function showMyAppointments() {
            const myAppointments = [];
            
            // Find all appointments for current customer
            stores.forEach(store => {
                if (store.appointments) {
                    store.appointments.forEach(apt => {
                        if (apt.customerId === currentUser.id) {
                            myAppointments.push({
                                ...apt,
                                storeName: store.name
                            });
                        }
                    });
                }
            });
            
            if (myAppointments.length === 0) {
                alert('Você ainda não tem agendamentos.');
                return;
            }
            
            // Sort by date
            myAppointments.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            const appointmentsList = myAppointments.map(apt => {
                const statusText = apt.status === 'confirmed' ? '✅ Confirmado' : 
                                 apt.status === 'cancelled' ? '❌ Cancelado' : 
                                 '⏳ Pendente';
                return `• ${apt.storeName}\n  📅 ${new Date(apt.date).toLocaleDateString('pt-BR')} às ${apt.time}\n  🛍️ ${apt.serviceName} - R$ ${apt.price.toFixed(2)}\n  ${statusText}`;
            }).join('\n\n');
            
            alert(`Seus Agendamentos:\n\n${appointmentsList}`);
        }

        function showReservationsManagement() {
            const store = stores.find(s => s.merchantId === currentUser.id);
            if (!store.reservations) store.reservations = [];
            
            const content = document.getElementById('merchantContent');
            content.innerHTML = `
                <h3 class="text-xl font-bold mb-4">🛒 Gerenciar Reservas</h3>
                
                <div class="bg-white rounded-lg p-6 shadow-lg">
                    <div class="flex justify-between items-center mb-6">
                        <h4 class="text-lg font-semibold">Reservas de Produtos</h4>
                        <div class="flex gap-2">
                            <button onclick="filterReservations('all')" class="px-3 py-1 rounded text-sm bg-blue-500 text-white" id="filter-all">Todas</button>
                            <button onclick="filterReservations('pending')" class="px-3 py-1 rounded text-sm bg-gray-100 hover:bg-gray-200" id="filter-pending">Pendentes</button>
                            <button onclick="filterReservations('confirmed')" class="px-3 py-1 rounded text-sm bg-gray-100 hover:bg-gray-200" id="filter-confirmed">Confirmadas</button>
                            <button onclick="filterReservations('completed')" class="px-3 py-1 rounded text-sm bg-gray-100 hover:bg-gray-200" id="filter-completed">Retiradas</button>
                        </div>
                    </div>
                    
                    <div id="reservationsList">
                        ${store.reservations.length === 0 ? 
                            '<p class="text-gray-500 text-center py-8">Nenhuma reserva ainda.</p>' :
                            store.reservations.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)).map(res => {
                                const pickupDate = new Date(res.pickupDate);
                                const isOverdue = pickupDate < new Date().setHours(0,0,0,0) && res.status === 'confirmed';
                                const statusColor = res.status === 'confirmed' ? 'green' : res.status === 'cancelled' ? 'red' : res.status === 'completed' ? 'blue' : 'yellow';
                                const statusText = res.status === 'confirmed' ? 'Confirmado' : res.status === 'cancelled' ? 'Cancelado' : res.status === 'completed' ? 'Retirado' : 'Pendente';
                                const statusIcon = res.status === 'confirmed' ? '✅' : res.status === 'cancelled' ? '❌' : res.status === 'completed' ? '✔️' : '⏳';
                                
                                return `
                                    <div class="border rounded-lg p-4 mb-4 reservation-item ${res.status} ${res.status === 'cancelled' ? 'opacity-75' : ''} ${isOverdue ? 'border-red-300 bg-red-50' : ''}">
                                        <div class="flex justify-between items-start">
                                            <div class="flex-1">
                                                <div class="flex items-center gap-3 mb-2">
                                                    <h5 class="font-bold text-lg">${res.customerName}</h5>
                                                    <span class="px-3 py-1 rounded-full text-sm font-medium bg-${statusColor}-100 text-${statusColor}-800">
                                                        ${statusIcon} ${statusText}
                                                    </span>
                                                    ${isOverdue ? '<span class="px-2 py-1 bg-red-100 text-red-800 rounded text-xs font-medium">Atrasado</span>' : ''}
                                                </div>
                                                
                                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600 mb-3">
                                                    <div class="space-y-1">
                                                        <div class="flex items-center">
                                                            <span class="mr-2">📦</span>
                                                            <span class="font-medium">${res.productName}</span>
                                                        </div>
                                                        <div class="flex items-center">
                                                            <span class="mr-2">📊</span>
                                                            <span>Quantidade: ${res.quantity}</span>
                                                        </div>
                                                        <div class="flex items-center">
                                                            <span class="mr-2">💰</span>
                                                            <span class="font-semibold text-green-600">R$ ${res.totalPrice.toFixed(2)} (R$ ${res.unitPrice.toFixed(2)} cada)</span>
                                                        </div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="flex items-center">
                                                            <span class="mr-2">📅</span>
                                                            <span>Retirada: ${pickupDate.toLocaleDateString('pt-BR', { 
                                                                weekday: 'short', 
                                                                day: '2-digit', 
                                                                month: '2-digit' 
                                                            })}</span>
                                                        </div>
                                                        <div class="flex items-center">
                                                            <span class="mr-2">📞</span>
                                                            <span>${res.customerPhone || 'Não informado'}</span>
                                                        </div>
                                                        <div class="flex items-center">
                                                            <span class="mr-2">📝</span>
                                                            <span class="text-xs">Reservado em ${new Date(res.createdAt).toLocaleDateString('pt-BR')}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                ${res.notes ? `
                                                    <div class="bg-gray-50 p-3 rounded-lg mb-3">
                                                        <div class="flex items-start">
                                                            <span class="mr-2 text-gray-500">💬</span>
                                                            <div>
                                                                <span class="text-sm font-medium text-gray-700">Observações do cliente:</span>
                                                                <p class="text-sm text-gray-600 mt-1">${res.notes}</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                ` : ''}
                                            </div>
                                            
                                            <div class="flex flex-col gap-2 ml-4">
                                                ${res.status === 'pending' ? `
                                                    <button onclick="confirmReservation('${res.id}')" class="bg-green-500 text-white px-4 py-2 rounded text-sm hover:bg-green-600 whitespace-nowrap">
                                                        ✅ Confirmar
                                                    </button>
                                                    <button onclick="cancelReservation('${res.id}')" class="bg-red-500 text-white px-4 py-2 rounded text-sm hover:bg-red-600 whitespace-nowrap">
                                                        ❌ Cancelar
                                                    </button>
                                                ` : res.status === 'confirmed' ? `
                                                    <button onclick="completeReservation('${res.id}')" class="bg-blue-500 text-white px-4 py-2 rounded text-sm hover:bg-blue-600 whitespace-nowrap">
                                                        ✔️ Marcar como Retirado
                                                    </button>
                                                    <button onclick="cancelReservation('${res.id}')" class="bg-red-500 text-white px-4 py-2 rounded text-sm hover:bg-red-600 whitespace-nowrap">
                                                        ❌ Cancelar
                                                    </button>
                                                ` : `
                                                    <span class="px-4 py-2 rounded text-sm bg-gray-100 text-gray-600 text-center">
                                                        ${res.status === 'completed' ? 'Finalizado' : 'Cancelado'}
                                                    </span>
                                                `}
                                                <button onclick="contactCustomer('${res.customerPhone}')" class="bg-green-600 text-white px-4 py-2 rounded text-sm hover:bg-green-700 whitespace-nowrap">
                                                    📞 Contatar
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')
                        }
                    </div>
                </div>
            `;
        }

        function filterReservations(status) {
            const items = document.querySelectorAll('.reservation-item');
            const buttons = document.querySelectorAll('[id^="filter-"]');
            
            // Update button styles
            buttons.forEach(btn => {
                btn.classList.remove('bg-blue-500', 'text-white');
                btn.classList.add('bg-gray-100', 'hover:bg-gray-200');
            });
            
            const activeButton = document.getElementById(`filter-${status}`);
            if (activeButton) {
                activeButton.classList.remove('bg-gray-100', 'hover:bg-gray-200');
                activeButton.classList.add('bg-blue-500', 'text-white');
            }
            
            // Filter items
            items.forEach(item => {
                if (status === 'all' || item.classList.contains(status)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function confirmReservation(reservationId) {
            const store = stores.find(s => s.merchantId === currentUser.id);
            const reservation = store.reservations.find(res => res.id === reservationId);
            
            if (reservation && confirm(`Confirmar reserva de ${reservation.productName} para ${reservation.customerName}?`)) {
                reservation.status = 'confirmed';
                showReservationsManagement();
                
                // Update store reservations count
                const reservationsElement = document.getElementById('storeReservations');
                if (reservationsElement) {
                    const confirmedCount = store.reservations.filter(r => r.status === 'confirmed').length;
                    reservationsElement.textContent = confirmedCount;
                }
                
                alert('Reserva confirmada! O cliente será notificado.');
            }
        }

        function cancelReservation(reservationId) {
            const store = stores.find(s => s.merchantId === currentUser.id);
            const reservation = store.reservations.find(res => res.id === reservationId);
            
            if (reservation && confirm(`Cancelar reserva de ${reservation.productName} para ${reservation.customerName}?`)) {
                reservation.status = 'cancelled';
                
                // Restore stock if applicable
                const product = store.products?.find(p => p.id === reservation.productId);
                if (product && product.stock !== null) {
                    product.stock += reservation.quantity;
                    product.available = true;
                }
                
                showReservationsManagement();
                alert('Reserva cancelada e estoque restaurado.');
            }
        }

        function completeReservation(reservationId) {
            const store = stores.find(s => s.merchantId === currentUser.id);
            const reservation = store.reservations.find(res => res.id === reservationId);
            
            if (reservation && confirm(`Marcar como retirado: ${reservation.productName} por ${reservation.customerName}?`)) {
                reservation.status = 'completed';
                reservation.completedAt = new Date();
                showReservationsManagement();
                alert('Reserva marcada como retirada!');
            }
        }

        function contactCustomer(phone) {
            if (!phone) {
                alert('Telefone do cliente não disponível.');
                return;
            }
            
            const whatsappNumber = phone.replace(/\D/g, '');
            const message = encodeURIComponent(`Olá! Entrando em contato sobre sua reserva em nossa loja.`);
            window.open(`https://wa.me/55${whatsappNumber}?text=${message}`, '_blank');
        }

        // Category filtering
        function filterByCategory(category) {
            currentCategory = category;
            
            // Update active button
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            const activeBtn = document.querySelector(`[data-category="${category}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
            
            // Filter stores
            if (category === 'todos') {
                filteredStores = [...stores];
            } else {
                filteredStores = stores.filter(store => store.category === category);
            }
            
            // Apply location filters if any
            filterByLocation();
        }

        // Support function
        function showSupport() {
            alert(`📞 Suporte\n\nTelefone: ${appSettings.contact.phone}\nWhatsApp: ${appSettings.contact.whatsapp}\nEmail: ${appSettings.contact.email}\n\nHorário: ${appSettings.contact.hours}`);
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Login form handler
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                const type = document.getElementById('loginType').value;
                
                if (!email || !password || !type) {
                    alert('Por favor, preencha todos os campos.');
                    return;
                }
                
                if (login(email, password, type)) {
                    // Login successful
                } else {
                    alert('Email, senha ou tipo de usuário incorretos!\n\n📋 Usuários de Teste:\n\n👨‍💼 Administrador:\n• Email: admin@app.com\n• Senha: admin123\n\n🏪 Lojistas:\n• Email: joao@padaria.com / Senha: 123456\n• Email: maria@boutique.com / Senha: 123456\n\n👥 Clientes:\n• Email: ana@email.com / Senha: 123456\n• Email: cliente@teste.com / Senha: 123456');
                }
            });
            
            // Register form handler
            document.getElementById('registerForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const name = document.getElementById('registerName').value;
                const email = document.getElementById('registerEmail').value;
                const password = document.getElementById('registerPassword').value;
                const confirmPassword = document.getElementById('registerConfirmPassword').value;
                const phone = document.getElementById('registerPhone').value;
                const document = document.getElementById('registerDocument').value;
                const storeName = document.getElementById('registerStoreName').value;
                const address = document.getElementById('registerAddress').value;
                
                register(name, email, password, confirmPassword, phone, document, storeName, address);
            });
            
            // Customer register form handler
            document.getElementById('customerRegisterForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const name = document.getElementById('customerRegisterName').value;
                const email = document.getElementById('customerRegisterEmail').value;
                const password = document.getElementById('customerRegisterPassword').value;
                const confirmPassword = document.getElementById('customerRegisterConfirmPassword').value;
                
                if (password !== confirmPassword) {
                    alert('As senhas não coincidem!');
                    return;
                }
                
                registerCustomer(name, email, password);
            });
            
            // Forgot password form handler
            document.getElementById('forgotPasswordForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('forgotEmail').value;
                const userType = document.getElementById('forgotUserType').value;
                
                alert(`Instruções de recuperação de senha enviadas para ${email}!\n\n(Esta é uma demonstração - em um sistema real, um email seria enviado)`);
                showLoginModal();
            });
            
            // Search functionality
            document.getElementById('searchInput').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                
                if (searchTerm === '') {
                    filteredStores = [...stores];
                } else {
                    filteredStores = stores.filter(store => 
                        store.name.toLowerCase().includes(searchTerm) ||
                        store.description.toLowerCase().includes(searchTerm) ||
                        store.categories?.some(cat => cat.toLowerCase().includes(searchTerm)) ||
                        store.address.toLowerCase().includes(searchTerm)
                    );
                }
                
                // Apply category filter if active
                if (currentCategory !== 'todos') {
                    filteredStores = filteredStores.filter(store => store.category === currentCategory);
                }
                
                renderStores();
            });
            
            // Edit merchant form handler
            document.getElementById('editMerchantForm').addEventListener('submit', saveEditMerchant);
            
            // Initialize the app
            showPublicView();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96e446c3b629f1c1',t:'MTc1NTA0NjgzNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

